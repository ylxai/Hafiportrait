"use strict";(()=>{var e={};e.id=6091,e.ids=[6091,6940],e.modules={21841:e=>{e.exports=require("@aws-sdk/client-s3")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{e.exports=require("sharp")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},7026:e=>{e.exports=require("googleapis")},32615:e=>{e.exports=require("http")},32694:e=>{e.exports=require("http2")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},84492:e=>{e.exports=require("node:stream")},38144:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>f,patchFetch:()=>F,requestAsyncStorage:()=>h,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var o={};a.r(o),a.d(o,{GET:()=>g,POST:()=>d});var r=a(30633),s=a(86488),i=a(13342),n=a(90223),l=a(68620),p=a(36940);async function g(){try{let e=await l.F.getHomepagePhotos();return n.NextResponse.json(e)}catch(e){return console.error("Error fetching homepage photos from API:",e),n.NextResponse.json({message:`Error fetching homepage photos: ${e.message}`},{status:500})}}async function d(e){try{let t=(await e.formData()).get("file");if(!t)return n.NextResponse.json({message:"No file uploaded"},{status:400});let a=await p.smartDatabase.uploadHomepagePhoto(t);return n.NextResponse.json(a,{status:201})}catch(e){return console.error("Error uploading homepage photo:",e),n.NextResponse.json({message:`Failed to upload photo: ${e.message}`},{status:500})}}let u=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/photos/homepage/route",pathname:"/api/photos/homepage",filename:"route",bundlePath:"app/api/photos/homepage/route"},resolvedPagePath:"/home/ubuntu/stable/src/app/api/photos/homepage/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:c,serverHooks:m}=u,f="/api/photos/homepage/route";function F(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},36940:(e,t,a)=>{a.d(t,{smartDatabase:()=>n});var o=a(68620),r=a(61646),s=a(87066);class i{async uploadEventPhoto(e,t,a="Anonymous",s="Tamu"){if(await o.F.validateEventAccess(e),!this.validateFileExtension(t.name))throw Error("Invalid file type. Allowed: jpg, jpeg, png, gif, webp");try{let o={eventId:e,albumName:s,uploaderName:a,isHomepage:!1,isPremium:"Official"===s,isFeatured:"Official"===s,fileSize:t.size,eventType:"wedding",fileType:t.type};console.log(`ðŸŽ¯ Uploading event photo via Smart Storage Manager`),console.log(`ðŸ“Š Event: ${e}, Album: ${s}, Uploader: ${a}`);let i=await r.C.uploadPhoto(t,o);console.log(`âœ… Smart Storage upload successful:`,{tier:i.tier,storage:i.storage,compression:i.compressionUsed});let{data:n,error:l}=await this.supabase.from("photos").insert({event_id:e,url:i.url,thumbnail_url:i.thumbnailUrl,original_name:t.name,uploader_name:a,album_name:s,is_homepage:!1,filename:this.generateFileName(t.name),storage_tier:i.tier,storage_provider:i.storage,compression_used:i.compressionUsed,file_size:i.size,storage_path:i.path,storage_etag:i.etag,storage_file_id:i.fileId}).select().single();if(l)throw console.error("âŒ Database insert failed:",l),l;return console.log(`âœ… Photo saved to database with Smart Storage metadata`),n}catch(r){console.error("âŒ Smart Storage upload failed:",r),console.log("\uD83D\uDD04 Falling back to original upload method...");try{return await o.F.uploadEventPhoto(e,t,a,s)}catch(e){throw console.error("âŒ Fallback upload also failed:",e),Error(`Both Smart Storage and fallback upload failed. Last error: ${e instanceof Error?e.message:"Unknown error"}`)}}}async uploadHomepagePhoto(e){if(!this.validateFileExtension(e.name))throw Error("Invalid file type. Allowed: jpg, jpeg, png, gif, webp");try{let t={albumName:"Homepage",uploaderName:"Admin",isHomepage:!0,isPremium:!0,isFeatured:!0,fileSize:e.size,eventType:"homepage",fileType:e.type};console.log(`ðŸŽ¯ Uploading homepage photo via Smart Storage Manager`);let a=await r.C.uploadPhoto(e,t);console.log(`âœ… Smart Storage homepage upload successful:`,{tier:a.tier,storage:a.storage,compression:a.compressionUsed});let{data:o,error:s}=await this.supabase.from("photos").insert({url:a.url,thumbnail_url:a.thumbnailUrl,original_name:e.name,is_homepage:!0,event_id:null,uploader_name:"Admin",album_name:"Homepage",filename:this.generateFileName(e.name),storage_tier:a.tier,storage_provider:a.storage,compression_used:a.compressionUsed,file_size:a.size,storage_path:a.path,storage_etag:a.etag,storage_file_id:a.fileId}).select().single();if(s)throw console.error("âŒ Database insert failed:",s),s;return console.log(`âœ… Homepage photo saved to database with Smart Storage metadata`),o}catch(t){console.error("âŒ Smart Storage homepage upload failed:",t),console.log("\uD83D\uDD04 Falling back to original upload method...");try{return await o.F.uploadHomepagePhoto(e)}catch(e){throw console.error("âŒ Fallback upload also failed:",e),Error(`Both Smart Storage and fallback upload failed. Last error: ${e instanceof Error?e.message:"Unknown error"}`)}}}async getStorageAnalytics(){try{let e=await r.C.getStorageReport(),{data:t,error:a}=await this.supabase.from("photos").select("storage_tier, storage_provider, file_size, compression_used, uploaded_at").not("storage_tier","is",null);a&&console.warn("âš ï¸ Could not fetch storage analytics from database:",a);let o=t?.reduce((e,t)=>{let a=t.storage_tier||"unknown";return e[a]||(e[a]={count:0,totalSize:0}),e[a].count++,e[a].totalSize+=t.file_size||0,e},{})||{};return{storageReport:e,tierStats:o,totalPhotosWithSmartStorage:t?.length||0,recentUploads:t?.slice(0,10)||[]}}catch(e){throw console.error("âŒ Error getting storage analytics:",e),e}}async cleanupOldFiles(e=30){await r.C.cleanupOldFiles(e)}validateFileExtension(e){let t=e.split(".").pop()?.toLowerCase();return!!t&&["jpg","jpeg","png","gif","webp"].includes(t)}generateFileName(e){let t=e.split(".").pop()?.toLowerCase()||"jpg",a=Date.now(),o=Math.random().toString(36).substring(2,8);return`${a}_${o}.${t}`}constructor(){this.supabase=s.supabaseAdmin,this.getAllEvents=o.F.getAllEvents.bind(o.F),this.getPublicEvents=o.F.getPublicEvents.bind(o.F),this.getEventById=o.F.getEventById.bind(o.F),this.createEvent=o.F.createEvent.bind(o.F),this.updateEvent=o.F.updateEvent.bind(o.F),this.deleteEvent=o.F.deleteEvent.bind(o.F),this.verifyEventAccessCode=o.F.verifyEventAccessCode.bind(o.F),this.getEventPhotos=o.F.getEventPhotos.bind(o.F),this.getHomepagePhotos=o.F.getHomepagePhotos.bind(o.F),this.getPhotoById=o.F.getPhotoById.bind(o.F),this.deletePhoto=o.F.deletePhoto.bind(o.F),this.likePhoto=o.F.likePhoto.bind(o.F),this.getEventMessages=o.F.getEventMessages.bind(o.F),this.createMessage=o.F.createMessage.bind(o.F),this.heartMessage=o.F.heartMessage.bind(o.F),this.getMessageById=o.F.getMessageById.bind(o.F),this.updateMessageHearts=o.F.updateMessageHearts.bind(o.F),this.addMessageReaction=o.F.addMessageReaction.bind(o.F),this.updateMessageReactions=o.F.updateMessageReactions.bind(o.F),this.getStats=o.F.getStats.bind(o.F),this.getEvents=o.F.getEvents.bind(o.F),this.getSimpleCompressionAnalytics=o.F.getSimpleCompressionAnalytics.bind(o.F),this.validateEventAccess=o.F.validateEventAccess.bind(o.F)}}let n=new i},61646:(e,t,a)=>{a.d(t,{C:()=>s});let o=a(82481);class r{constructor(){this.initialized=!1,this.storageManager=new o({local:{backupFolder:process.env.LOCAL_BACKUP_PATH||"./DSLR-System/Backup/dslr-backup"}})}async initialize(){this.initialized||(await this.storageManager.initializeProviders(),this.initialized=!0,console.log("âœ… Storage Adapter initialized"))}async uploadPhoto(e,t){await this.initialize();let a=await e.arrayBuffer(),o={buffer:Buffer.from(a),name:e.name,size:e.size,type:e.type},r={eventId:t.eventId,albumName:t.albumName,uploaderName:t.uploaderName,isHomepage:t.isHomepage,isPremium:t.isPremium||!1,isFeatured:t.isFeatured||!1,fileSize:t.fileSize,eventType:t.eventType||"standard",fileType:t.fileType};console.log(`ðŸš€ Uploading ${e.name} via Smart Storage Manager`),console.log(`ðŸ“Š Metadata:`,r);try{let e=await this.storageManager.uploadPhoto(o,r);return console.log(`âœ… Upload successful:`,{tier:e.tier,storage:e.storage,url:e.url,size:e.size}),e}catch(e){throw console.error("âŒ Storage upload failed:",e),Error(`Storage upload failed: ${e instanceof Error?e.message:"Unknown error"}`)}}async getStorageReport(){return await this.initialize(),this.storageManager.getStorageReport()}async cleanupOldFiles(e=30){await this.initialize(),await this.storageManager.cleanupOldFiles(e)}async hasStorageSpace(e,t){return await this.initialize(),this.storageManager.hasSpace(e,t)}async determineStorageTier(e){return await this.initialize(),this.storageManager.determineStorageTier(e)}}let s=new r}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),o=t.X(0,[2782,606,3716,7851,8620,2481],()=>a(38144));module.exports=o})();