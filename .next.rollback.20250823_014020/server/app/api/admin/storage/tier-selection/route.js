"use strict";(()=>{var e={};e.id=6151,e.ids=[6151],e.modules={21841:e=>{e.exports=require("@aws-sdk/client-s3")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{e.exports=require("sharp")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},7026:e=>{e.exports=require("googleapis")},32615:e=>{e.exports=require("http")},32694:e=>{e.exports=require("http2")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},84492:e=>{e.exports=require("node:stream")},14195:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>h,requestAsyncStorage:()=>u,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d});var a={};t.r(a),t.d(a,{POST:()=>p});var i=t(30633),o=t(86488),s=t(13342),n=t(90223),l=t(61646);async function p(e){try{let{fileSize:r,eventId:t,albumName:a,uploaderName:i,isHomepage:o=!1,isPremium:s=!1,isFeatured:p=!1,eventType:c="standard",fileType:u="image/jpeg"}=await e.json();if(!r)return n.NextResponse.json({error:"File size is required"},{status:400});console.log(`ðŸŽ¯ Determining storage tier for file size: ${r} bytes`);let d={eventId:t,albumName:a||"Tamu",uploaderName:i||"Anonymous",isHomepage:o,isPremium:s,isFeatured:p,fileSize:r,eventType:c,fileType:u},g=await l.C.determineStorageTier(d),m={cloudflareR2:await l.C.hasStorageSpace("cloudflareR2",r),googleDrive:await l.C.hasStorageSpace("googleDrive",r),local:await l.C.hasStorageSpace("local",r)};return console.log(`âœ… Tier selection completed:`,{selectedTier:g.tier,compression:g.compression,priority:g.priority}),n.NextResponse.json({success:!0,data:{selectedTier:g,spaceAvailability:m,metadata:d,recommendations:{tier:g.tier,reason:function(e,r){let t=e.tier;return"cloudflareR2"===t?r.cloudflareR2?"Cloudflare R2 selected for optimal performance and global CDN access":"Cloudflare R2 preferred but no space available":"googleDrive"===t?"Google Drive selected as secondary storage with good reliability":"local"===t?"Local storage selected as fallback option":"Tier selection based on availability and file characteristics"}(g,m),compression:g.compression,priority:g.priority}},timestamp:new Date().toISOString()})}catch(e){return console.error("âŒ Error in tier selection:",e),e instanceof Error&&e.message,n.NextResponse.json({success:!1,error:"Tier selection failed",details:void 0},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/storage/tier-selection/route",pathname:"/api/admin/storage/tier-selection",filename:"route",bundlePath:"app/api/admin/storage/tier-selection/route"},resolvedPagePath:"/home/ubuntu/stable/src/app/api/admin/storage/tier-selection/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:u,staticGenerationAsyncStorage:d,serverHooks:g}=c,m="/api/admin/storage/tier-selection/route";function h(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}},61646:(e,r,t)=>{t.d(r,{C:()=>o});let a=t(82481);class i{constructor(){this.initialized=!1,this.storageManager=new a({local:{backupFolder:process.env.LOCAL_BACKUP_PATH||"./DSLR-System/Backup/dslr-backup"}})}async initialize(){this.initialized||(await this.storageManager.initializeProviders(),this.initialized=!0,console.log("âœ… Storage Adapter initialized"))}async uploadPhoto(e,r){await this.initialize();let t=await e.arrayBuffer(),a={buffer:Buffer.from(t),name:e.name,size:e.size,type:e.type},i={eventId:r.eventId,albumName:r.albumName,uploaderName:r.uploaderName,isHomepage:r.isHomepage,isPremium:r.isPremium||!1,isFeatured:r.isFeatured||!1,fileSize:r.fileSize,eventType:r.eventType||"standard",fileType:r.fileType};console.log(`ðŸš€ Uploading ${e.name} via Smart Storage Manager`),console.log(`ðŸ“Š Metadata:`,i);try{let e=await this.storageManager.uploadPhoto(a,i);return console.log(`âœ… Upload successful:`,{tier:e.tier,storage:e.storage,url:e.url,size:e.size}),e}catch(e){throw console.error("âŒ Storage upload failed:",e),Error(`Storage upload failed: ${e instanceof Error?e.message:"Unknown error"}`)}}async getStorageReport(){return await this.initialize(),this.storageManager.getStorageReport()}async cleanupOldFiles(e=30){await this.initialize(),await this.storageManager.cleanupOldFiles(e)}async hasStorageSpace(e,r){return await this.initialize(),this.storageManager.hasSpace(e,r)}async determineStorageTier(e){return await this.initialize(),this.storageManager.determineStorageTier(e)}}let o=new i}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[2782,606,7851,2481],()=>t(14195));module.exports=a})();