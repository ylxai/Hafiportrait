"use strict";(()=>{var e={};e.id=7285,e.ids=[7285,7066],e.modules={21841:e=>{e.exports=require("@aws-sdk/client-s3")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{e.exports=require("sharp")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},7026:e=>{e.exports=require("googleapis")},32615:e=>{e.exports=require("http")},32694:e=>{e.exports=require("http2")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},84492:e=>{e.exports=require("node:stream")},75500:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>S,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>p});var s=r(30633),o=r(86488),i=r(13342),n=r(90223),l=r(61646),u=r(87066);async function p(e){try{console.log("\uD83D\uDCCA Fetching comprehensive storage status...");let e=await l.C.getStorageReport(),{data:t,error:r}=await u.supabaseAdmin.from("photos").select("storage_tier, storage_provider, file_size, compression_used, uploaded_at, album_name").not("storage_tier","is",null).order("uploaded_at",{ascending:!1});r&&console.warn("âš ï¸ Could not fetch Smart Storage photos:",r);let{count:a,error:s}=await u.supabaseAdmin.from("photos").select("*",{count:"exact",head:!0});s&&console.warn("âš ï¸ Could not fetch total photos count:",s);let o=t?.length||0,i=a||0,p=i>0?o/i*100:0,c=t?.reduce((e,t)=>{let r=t.storage_tier||"unknown",a=t.storage_provider||"unknown";return e[r]||(e[r]={count:0,totalSize:0,providers:{}}),e[r].count++,e[r].totalSize+=t.file_size||0,e[r].providers[a]||(e[r].providers[a]=0),e[r].providers[a]++,e},{})||{},d=t?.reduce((e,t)=>{let r=t.album_name||"Unknown";return e[r]||(e[r]={count:0,totalSize:0}),e[r].count++,e[r].totalSize+=t.file_size||0,e},{})||{},g=new Date;g.setDate(g.getDate()-1);let h=t?.filter(e=>new Date(e.uploaded_at)>g)||[],m={storageReport:e,smartStorageAdoption:{totalPhotos:i,smartStoragePhotos:o,adoptionRate:Math.round(100*p)/100,legacyPhotos:i-o},tierDistribution:c,albumDistribution:d,recentActivity:{last24Hours:h.length,recentUploads:h.slice(0,10)},systemHealth:{cloudflareR2Available:!!(process.env.CLOUDFLARE_R2_ACCOUNT_ID&&process.env.CLOUDFLARE_R2_ACCESS_KEY_ID&&process.env.CLOUDFLARE_R2_SECRET_ACCESS_KEY&&process.env.CLOUDFLARE_R2_BUCKET_NAME),googleDriveAvailable:!!(process.env.GOOGLE_DRIVE_CLIENT_ID&&process.env.GOOGLE_DRIVE_CLIENT_SECRET&&process.env.GOOGLE_DRIVE_REFRESH_TOKEN),localStorageAvailable:!0}};return console.log("âœ… Storage status retrieved successfully"),console.log(`ðŸ“Š Smart Storage adoption: ${p.toFixed(1)}% (${o}/${i})`),n.NextResponse.json({success:!0,data:m,timestamp:new Date().toISOString()})}catch(e){return console.error("âŒ Error fetching storage status:",e),e instanceof Error&&e.message,n.NextResponse.json({success:!1,error:"Failed to fetch storage status",details:void 0},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/storage/status/route",pathname:"/api/admin/storage/status",filename:"route",bundlePath:"app/api/admin/storage/status/route"},resolvedPagePath:"/home/ubuntu/stable/src/app/api/admin/storage/status/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:g,serverHooks:h}=c,m="/api/admin/storage/status/route";function S(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},61646:(e,t,r)=>{r.d(t,{C:()=>o});let a=r(82481);class s{constructor(){this.initialized=!1,this.storageManager=new a({local:{backupFolder:process.env.LOCAL_BACKUP_PATH||"./DSLR-System/Backup/dslr-backup"}})}async initialize(){this.initialized||(await this.storageManager.initializeProviders(),this.initialized=!0,console.log("âœ… Storage Adapter initialized"))}async uploadPhoto(e,t){await this.initialize();let r=await e.arrayBuffer(),a={buffer:Buffer.from(r),name:e.name,size:e.size,type:e.type},s={eventId:t.eventId,albumName:t.albumName,uploaderName:t.uploaderName,isHomepage:t.isHomepage,isPremium:t.isPremium||!1,isFeatured:t.isFeatured||!1,fileSize:t.fileSize,eventType:t.eventType||"standard",fileType:t.fileType};console.log(`ðŸš€ Uploading ${e.name} via Smart Storage Manager`),console.log(`ðŸ“Š Metadata:`,s);try{let e=await this.storageManager.uploadPhoto(a,s);return console.log(`âœ… Upload successful:`,{tier:e.tier,storage:e.storage,url:e.url,size:e.size}),e}catch(e){throw console.error("âŒ Storage upload failed:",e),Error(`Storage upload failed: ${e instanceof Error?e.message:"Unknown error"}`)}}async getStorageReport(){return await this.initialize(),this.storageManager.getStorageReport()}async cleanupOldFiles(e=30){await this.initialize(),await this.storageManager.cleanupOldFiles(e)}async hasStorageSpace(e,t){return await this.initialize(),this.storageManager.hasSpace(e,t)}async determineStorageTier(e){return await this.initialize(),this.storageManager.determineStorageTier(e)}}let o=new s},87066:(e,t,r)=>{r.d(t,{OQ:()=>o,eI:()=>n,supabaseAdmin:()=>i});var a=r(33716);let s=()=>"https://azspktldiblhrwebzmwq.supabase.co",o=(0,a.eI)(s(),(()=>{let e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6c3BrdGxkaWJsaHJ3ZWJ6bXdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NDQwNDQsImV4cCI6MjA2OTUyMDA0NH0.uKHB4K9hxUDTc0ZkwidCJv_Ev-oa99AflFvrFt_8MG8";if(!e)throw Error("NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable is required");return e})()),i=(0,a.eI)(s(),(()=>{let e=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e)throw Error("SUPABASE_SERVICE_ROLE_KEY environment variable is required");return e})(),{auth:{autoRefreshToken:!1,persistSession:!1}});function n(){return(0,a.eI)("https://azspktldiblhrwebzmwq.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}process.env.SUPABASE_STORAGE_BUCKET}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[2782,606,3716,7851,2481],()=>r(75500));module.exports=a})();