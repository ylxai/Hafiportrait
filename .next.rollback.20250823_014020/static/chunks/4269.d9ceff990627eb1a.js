"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4269],{4269:function(e,t,a){a.r(t),a.d(t,{SmartNotificationManager:function(){return S}});var i=a(881),n=a(4149),s=a(5949),l=a(3939),r=a(7324),c=a(5876),o=a(4120),d=a(9975),u=a(2238),m=a(5313);function h(e){let{id:t,type:a,title:h,message:g,icon:v,duration:p=5e3,persistent:f=!1,priority:x="medium",action:b,secondaryAction:k,onDismiss:w}=e,[D,y]=(0,n.useState)(!0),[j,E]=(0,n.useState)(p);(0,n.useState)(()=>{if(f)return;let e=setInterval(()=>{E(e=>e<=100?(y(!1),setTimeout(()=>w(t),300),0):e-100)},100);return()=>clearInterval(e)});let N=()=>{y(!1),setTimeout(()=>w(t),300)},C={success:{bg:"bg-green-50 border-green-200",icon:(0,i.jsx)(r.Z,{className:"w-5 h-5 text-green-600"}),titleColor:"text-green-900",messageColor:"text-green-700"},warning:{bg:"bg-yellow-50 border-yellow-200",icon:(0,i.jsx)(c.Z,{className:"w-5 h-5 text-yellow-600"}),titleColor:"text-yellow-900",messageColor:"text-yellow-700"},error:{bg:"bg-red-50 border-red-200",icon:(0,i.jsx)(o.Z,{className:"w-5 h-5 text-red-600"}),titleColor:"text-red-900",messageColor:"text-red-700"},info:{bg:"bg-blue-50 border-blue-200",icon:(0,i.jsx)(d.Z,{className:"w-5 h-5 text-blue-600"}),titleColor:"text-blue-900",messageColor:"text-blue-700"}}[a],S=f?100:j/p*100;return D?(0,i.jsxs)("div",{className:"\n      relative w-full max-w-md p-4 rounded-lg border shadow-lg\n      transform transition-all duration-300 ease-in-out\n      ".concat(D?"translate-x-0 opacity-100":"translate-x-full opacity-0","\n      ").concat(C.bg,"\n    "),children:[!f&&(0,i.jsx)("div",{className:"absolute top-0 left-0 h-1 bg-gray-200 rounded-t-lg w-full overflow-hidden",children:(0,i.jsx)("div",{className:"h-full bg-current transition-all duration-100 ease-linear",style:{width:"".concat(S,"%"),backgroundColor:"error"===a?"#ef4444":"warning"===a?"#f59e0b":"success"===a?"#10b981":"#3b82f6"}})}),(0,i.jsxs)("div",{className:"flex items-start gap-3",children:[(0,i.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:v?(0,i.jsx)("span",{className:"text-lg",children:v}):C.icon}),(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,i.jsx)("h4",{className:"font-semibold text-sm ".concat(C.titleColor),children:h}),"low"===x?null:({urgent:(0,i.jsx)(l.C,{variant:"destructive",className:"text-xs animate-pulse",children:"Urgent"}),high:(0,i.jsx)(l.C,{variant:"destructive",className:"text-xs bg-orange-500",children:"High"}),medium:(0,i.jsx)(l.C,{variant:"secondary",className:"text-xs",children:"Medium"})})[x]]}),(0,i.jsx)("p",{className:"text-sm ".concat(C.messageColor," mb-3"),children:g}),(b||k)&&(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[b&&(0,i.jsxs)(s.z,{size:"sm",variant:"outline",onClick:()=>{b.callback(),N()},className:"text-xs h-7",children:[b.label,(0,i.jsx)(u.Z,{className:"w-3 h-3 ml-1"})]}),k&&(0,i.jsx)(s.z,{size:"sm",variant:"ghost",onClick:()=>{k.callback(),N()},className:"text-xs h-7",children:k.label})]})]}),(0,i.jsx)(s.z,{variant:"ghost",size:"sm",onClick:N,className:"h-6 w-6 p-0 flex-shrink-0",children:(0,i.jsx)(m.Z,{className:"w-4 h-4"})})]})]}):null}function g(e){let{toasts:t,onDismiss:a}=e,n=[...t].sort((e,t)=>{let a={urgent:4,high:3,medium:2,low:1},i=a[e.priority||"medium"];return a[t.priority||"medium"]-i});return(0,i.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-md",children:n.map(e=>(0,i.jsx)(h,{...e,onDismiss:a},e.id))})}var v=a(3575),p=a(1840),f=a(6756);let x=n.forwardRef((e,t)=>{let{className:a,children:n,...s}=e;return(0,i.jsxs)(p.fC,{ref:t,className:(0,f.cn)("relative overflow-hidden",a),...s,children:[(0,i.jsx)(p.l_,{className:"h-full w-full rounded-[inherit]",children:n}),(0,i.jsx)(b,{}),(0,i.jsx)(p.Ns,{})]})});x.displayName=p.fC.displayName;let b=n.forwardRef((e,t)=>{let{className:a,orientation:n="vertical",...s}=e;return(0,i.jsx)(p.gb,{ref:t,orientation:n,className:(0,f.cn)("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...s,children:(0,i.jsx)(p.q4,{className:"relative flex-1 rounded-full bg-border"})})});b.displayName=p.gb.displayName;var k=a(3377),w=a(9968),D=a(6578),y=a(7131),j=a(5939),E=a(979);class N{static getStatusChangeNotification(e,t,a){return({"draft->active":{type:"success",title:"\uD83C\uDF89 Event Dimulai!",message:'Event "'.concat(e.name,'" sekarang aktif. Tamu sudah bisa upload foto dan kirim pesan.'),icon:"▶️",action:{label:"Lihat Event",url:"/event/".concat(e.id)}},"active->paused":{type:"warning",title:"⏸️ Event Dijeda",message:'Event "'.concat(e.name,'" dijeda sementara. Upload foto dan pesan dihentikan.'),icon:"⏸️",action:{label:"Lanjutkan Event",callback:()=>console.log("Resume event")}},"paused->active":{type:"info",title:"▶️ Event Dilanjutkan",message:'Event "'.concat(e.name,'" dilanjutkan. Tamu kembali bisa berinteraksi.'),icon:"▶️"},"active->completed":{type:"success",title:"✅ Event Selesai!",message:'Event "'.concat(e.name,'" telah selesai. Siap untuk backup dan archive.'),icon:"✅",action:{label:"Backup Event",callback:()=>console.log("Start backup")}},"completed->archived":{type:"info",title:"\uD83D\uDCE6 Event Diarsipkan",message:'Event "'.concat(e.name,'" berhasil diarsipkan untuk penyimpanan jangka panjang.'),icon:"\uD83D\uDCE6"},"active->cancelled":{type:"error",title:"❌ Event Dibatalkan",message:'Event "'.concat(e.name,'" telah dibatalkan. Semua aktivitas dihentikan.'),icon:"❌"},"cancelled->active":{type:"success",title:"\uD83D\uDD04 Event Direaktivasi",message:'Event "'.concat(e.name,'" berhasil diaktifkan kembali.'),icon:"\uD83D\uDD04"},"archived->active":{type:"warning",title:"\uD83D\uDCE4 Event Direaktivasi dari Archive",message:'Event "'.concat(e.name,'" dikeluarkan dari archive dan diaktifkan kembali.'),icon:"\uD83D\uDCE4"}})["".concat(t,"->").concat(a)]||{type:"info",title:"Status Event Berubah",message:'Event "'.concat(e.name,'" berubah dari ').concat(t," ke ").concat(a,"."),icon:"\uD83D\uDD04"}}static getAutoStatusNotifications(e){let t=[];return e.autoComplete.processed>0&&t.push({type:"success",title:"✅ Auto-Complete Berhasil",message:"".concat(e.autoComplete.processed," event expired otomatis diselesaikan."),icon:"✅"}),e.autoActivate.processed>0&&t.push({type:"info",title:"\uD83D\uDE80 Auto-Activate Berhasil",message:"".concat(e.autoActivate.processed," event hari ini otomatis diaktifkan."),icon:"\uD83D\uDE80"}),e.archiveSuggestions.length>0&&t.push({type:"warning",title:"\uD83D\uDCA1 Saran Archive",message:"".concat(e.archiveSuggestions.length," event siap untuk diarsipkan."),icon:"\uD83D\uDCA1",action:{label:"Lihat Saran",callback:()=>console.log("Show archive suggestions")}}),e.summary.errors.length>0&&t.push({type:"error",title:"⚠️ Ada Error",message:"".concat(e.summary.errors.length," event gagal diproses otomatis."),icon:"⚠️",action:{label:"Lihat Detail",callback:()=>console.log("Show errors")}}),t}static getEventTimelineNotifications(e){let t=[],a=new Date,i=a.toDateString(),n=e.filter(e=>new Date(e.date).toDateString()===i);if(n.length>0){let e=n.filter(e=>"active"===e.status).length,a=n.filter(e=>"draft"===e.status).length;a>0&&t.push({type:"warning",title:"\uD83D\uDCC5 Event Hari Ini Belum Aktif",message:"".concat(a," event hari ini masih berstatus draft."),icon:"\uD83D\uDCC5",action:{label:"Aktifkan Sekarang",callback:()=>console.log("Activate today events")}}),e>0&&t.push({type:"info",title:"\uD83C\uDF89 Event Hari Ini Aktif",message:"".concat(e," event sedang berlangsung hari ini."),icon:"\uD83C\uDF89"})}let s=e.filter(e=>{let t=new Date(e.date),i=Math.floor((a.getTime()-t.getTime())/864e5);return"active"===e.status&&i>1});return s.length>0&&t.push({type:"warning",title:"⏰ Event Aktif Sudah Lewat",message:"".concat(s.length," event masih aktif padahal sudah lewat tanggal."),icon:"⏰",action:{label:"Auto-Complete",callback:()=>console.log("Auto-complete overdue events")}}),t}static formatForToast(e){return{title:e.title,description:e.message,variant:"error"===e.type?"destructive":"default"}}static formatForNotificationCenter(e){return{id:"status-".concat(Date.now(),"-").concat(Math.random()),type:e.type,title:e.title,message:e.message,icon:e.icon,timestamp:new Date().toISOString(),action:e.action,read:!1}}}function C(e){let{events:t,onRefresh:a}=e,{toast:u}=(0,E.pm)(),[h,g]=(0,n.useState)([]),[p,f]=(0,n.useState)(!1),[b,C]=(0,n.useState)("all"),[S,A]=(0,n.useState)(!0);(0,n.useEffect)(()=>{I()},[t]),(0,n.useEffect)(()=>{if(!S)return;let e=setInterval(()=>{I()},3e4);return()=>clearInterval(e)},[S,t]);let I=()=>{let e=[];N.getEventTimelineNotifications(t).forEach(t=>{e.push({id:"timeline-".concat(Date.now(),"-").concat(Math.random()),type:t.type,category:"timeline",title:t.title,message:t.message,icon:t.icon,timestamp:new Date().toISOString(),read:!1,priority:"warning"===t.type?"high":"medium",action:t.action?{label:t.action.label,callback:t.action.callback||(()=>{})}:void 0})}),t.forEach(t=>{let a=new Date(t.date),i=new Date,n=Math.floor((i.getTime()-a.getTime())/864e5);"active"===t.status&&n>1&&e.push({id:"overdue-".concat(t.id),type:"warning",category:"status",title:"⏰ Event Aktif Sudah Lewat",message:'Event "'.concat(t.name,'" masih aktif padahal sudah ').concat(n," hari lewat tanggal."),icon:"⏰",timestamp:new Date().toISOString(),read:!1,priority:"high",eventId:t.id,eventName:t.name,action:{label:"Selesaikan Event",callback:()=>z(t.id)}}),"draft"===t.status&&a.toDateString()===i.toDateString()&&e.push({id:"draft-today-".concat(t.id),type:"warning",category:"timeline",title:"\uD83D\uDCC5 Event Hari Ini Belum Aktif",message:'Event "'.concat(t.name,'" hari ini masih berstatus draft.'),icon:"\uD83D\uDCC5",timestamp:new Date().toISOString(),read:!1,priority:"high",eventId:t.id,eventName:t.name,action:{label:"Aktifkan Sekarang",callback:()=>T(t.id)}}),"completed"===t.status&&n>7&&!t.is_archived&&e.push({id:"archive-ready-".concat(t.id),type:"info",category:"status",title:"\uD83D\uDCE6 Siap untuk Archive",message:'Event "'.concat(t.name,'" sudah selesai ').concat(n," hari, siap diarsipkan."),icon:"\uD83D\uDCE6",timestamp:new Date().toISOString(),read:!1,priority:"medium",eventId:t.id,eventName:t.name,action:{label:"Arsipkan",callback:()=>Z(t.id)}}),"active"===t.status&&0===t.photo_count&&0===t.message_count&&n>=0&&e.push({id:"low-activity-".concat(t.id),type:"info",category:"status",title:"\uD83D\uDCCA Event Tidak Ada Aktivitas",message:'Event "'.concat(t.name,'" aktif tapi belum ada foto atau pesan dari tamu.'),icon:"\uD83D\uDCCA",timestamp:new Date().toISOString(),read:!1,priority:"low",eventId:t.id,eventName:t.name})}),t.length;let a=t.filter(e=>"active"===e.status).length,i=t.filter(e=>"completed"===e.status).length;a>5&&e.push({id:"many-active-".concat(Date.now()),type:"warning",category:"system",title:"⚡ Banyak Event Aktif",message:"Anda memiliki ".concat(a," event aktif. Pertimbangkan untuk menyelesaikan yang sudah lewat."),icon:"⚡",timestamp:new Date().toISOString(),read:!1,priority:"medium"}),i>10&&e.push({id:"many-completed-".concat(Date.now()),type:"info",category:"system",title:"\uD83D\uDCC8 Banyak Event Selesai",message:"".concat(i," event sudah selesai. Pertimbangkan untuk backup dan archive."),icon:"\uD83D\uDCC8",timestamp:new Date().toISOString(),read:!1,priority:"low"}),g(t=>{let a=t.map(e=>e.id);return[...t,...e.filter(e=>!a.includes(e.id))].slice(-50)})},z=e=>{console.log("Complete event:",e),u({title:"Event Diselesaikan",description:"Event berhasil diubah ke status completed."})},T=e=>{console.log("Activate event:",e),u({title:"Event Diaktifkan",description:"Event berhasil diaktifkan."})},Z=e=>{console.log("Archive event:",e),u({title:"Event Diarsipkan",description:"Event berhasil diarsipkan."})},L=e=>{g(t=>t.map(t=>t.id===e?{...t,read:!0}:t))},F=e=>{g(t=>t.filter(t=>t.id!==e))},O=()=>{let e=h;switch(b){case"unread":e=h.filter(e=>!e.read);break;case"high":e=h.filter(e=>"high"===e.priority||"urgent"===e.priority);break;default:e=h}return e.sort((e,t)=>{let a={urgent:4,high:3,medium:2,low:1},i=a[e.priority],n=a[t.priority];return i!==n?n-i:new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()})},_=h.filter(e=>!e.read).length,B=h.filter(e=>("high"===e.priority||"urgent"===e.priority)&&!e.read).length,M=e=>({success:(0,i.jsx)(r.Z,{className:"w-4 h-4 text-green-600"}),warning:(0,i.jsx)(c.Z,{className:"w-4 h-4 text-yellow-600"}),error:(0,i.jsx)(o.Z,{className:"w-4 h-4 text-red-600"}),info:(0,i.jsx)(d.Z,{className:"w-4 h-4 text-blue-600"})})[e.type],R=e=>({urgent:(0,i.jsx)(l.C,{variant:"destructive",className:"text-xs",children:"Urgent"}),high:(0,i.jsx)(l.C,{variant:"destructive",className:"text-xs bg-orange-500",children:"High"}),medium:(0,i.jsx)(l.C,{variant:"secondary",className:"text-xs",children:"Medium"}),low:(0,i.jsx)(l.C,{variant:"outline",className:"text-xs",children:"Low"})})[e];return(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsxs)(s.z,{variant:"ghost",size:"sm",onClick:()=>f(!p),className:"relative",children:[(0,i.jsx)(k.Z,{className:"w-5 h-5"}),_>0&&(0,i.jsx)(l.C,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs",children:_>99?"99+":_}),B>0&&(0,i.jsx)("div",{className:"absolute -top-1 -right-1 h-3 w-3 bg-red-500 rounded-full animate-pulse"})]}),p&&(0,i.jsxs)(v.Zb,{className:"absolute right-0 top-12 w-96 max-h-96 shadow-lg border z-50 bg-white",children:[(0,i.jsxs)(v.Ol,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)(v.ll,{className:"text-lg flex items-center gap-2",children:[(0,i.jsx)(k.Z,{className:"w-5 h-5"}),"Notifications",_>0&&(0,i.jsx)(l.C,{variant:"secondary",children:_})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(s.z,{variant:"ghost",size:"sm",onClick:()=>A(!S),title:S?"Disable auto refresh":"Enable auto refresh",children:S?(0,i.jsx)(w.Z,{className:"w-4 h-4"}):(0,i.jsx)(D.Z,{className:"w-4 h-4"})}),(0,i.jsx)(s.z,{variant:"ghost",size:"sm",onClick:()=>f(!1),children:(0,i.jsx)(m.Z,{className:"w-4 h-4"})})]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)(s.z,{variant:"all"===b?"default":"outline",size:"sm",onClick:()=>C("all"),children:["All (",h.length,")"]}),(0,i.jsxs)(s.z,{variant:"unread"===b?"default":"outline",size:"sm",onClick:()=>C("unread"),children:["Unread (",_,")"]}),(0,i.jsxs)(s.z,{variant:"high"===b?"default":"outline",size:"sm",onClick:()=>C("high"),children:["High (",B,")"]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)(s.z,{variant:"outline",size:"sm",onClick:()=>{g(e=>e.map(e=>({...e,read:!0})))},disabled:0===_,children:[(0,i.jsx)(y.Z,{className:"w-3 h-3 mr-1"}),"Mark All Read"]}),(0,i.jsxs)(s.z,{variant:"outline",size:"sm",onClick:()=>{g([])},disabled:0===h.length,children:[(0,i.jsx)(j.Z,{className:"w-3 h-3 mr-1"}),"Clear All"]})]})]}),(0,i.jsx)(v.aY,{className:"p-0",children:(0,i.jsx)(x,{className:"h-64",children:0===O().length?(0,i.jsxs)("div",{className:"p-6 text-center text-gray-500",children:[(0,i.jsx)(k.Z,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),(0,i.jsx)("p",{children:"No notifications"})]}):(0,i.jsx)("div",{className:"space-y-1",children:O().map(e=>(0,i.jsx)("div",{className:"p-3 border-b hover:bg-gray-50 cursor-pointer ".concat(e.read?"":"bg-blue-50 border-l-4 border-l-blue-500"),onClick:()=>L(e.id),children:(0,i.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,i.jsxs)("div",{className:"flex items-start gap-2 flex-1",children:[M(e),(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,i.jsx)("p",{className:"font-medium text-sm truncate",children:e.title}),R(e.priority)]}),(0,i.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:e.message}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{className:"text-xs text-gray-400",children:new Date(e.timestamp).toLocaleTimeString("id-ID")}),e.action&&(0,i.jsx)(s.z,{size:"sm",variant:"outline",onClick:t=>{var a;t.stopPropagation(),(null===(a=e.action)||void 0===a?void 0:a.callback)&&e.action.callback(),L(e.id)},className:"text-xs h-6",children:e.action.label})]})]})]}),(0,i.jsx)(s.z,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),F(e.id)},className:"h-6 w-6 p-0",children:(0,i.jsx)(m.Z,{className:"w-3 h-3"})})]})},e.id))})})})]})]})}function S(e){let{events:t,onRefresh:a,onStatusChange:s}=e,[l,r]=(0,n.useState)([]),[c,o]=(0,n.useState)({showToasts:!0,autoRefresh:!0,soundEnabled:!1,priorityFilter:"medium"}),{notifications:d,triggerStatusChange:u,triggerAutoStatus:m,showSuccess:h,showError:v,showWarning:p,showInfo:f}=function(e){let{toast:t}=(0,E.pm)(),[a,i]=(0,n.useState)([]),[s,l]=(0,n.useState)(e.length);(0,n.useEffect)(()=>{let a=a=>{let{eventId:n,eventName:s,oldStatus:l,newStatus:r}=a.detail,c=e.find(e=>e.id===n);if(!c)return;let o=N.getStatusChangeNotification(c,l,r);t(N.formatForToast(o));let d=N.formatForNotificationCenter(o);i(e=>[d,...e].slice(0,50))},n=e=>{let{type:a,result:n}=e.detail;N.getAutoStatusNotifications(n).forEach(e=>{("error"===e.type||"warning"===e.type)&&t(N.formatForToast(e));let a=N.formatForNotificationCenter(e);i(e=>[a,...e].slice(0,50))})};return window.addEventListener("event-status-changed",a),window.addEventListener("auto-status-completed",n),()=>{window.removeEventListener("event-status-changed",a),window.removeEventListener("auto-status-completed",n)}},[e,t]),(0,n.useEffect)(()=>{if(e.length>s){let a=e.length-s;t({title:"\uD83C\uDF89 Event Baru Ditambahkan!",description:"".concat(a," event baru telah dibuat.")})}l(e.length)},[e.length,s,t]);let r=(0,n.useCallback)(()=>{N.getEventTimelineNotifications(e).forEach(e=>{"warning"===e.type&&t(N.formatForToast(e));let a=N.formatForNotificationCenter(e);i(e=>e.some(e=>e.title===a.title&&e.message===a.message)?e:[a,...e].slice(0,50))})},[e,t]);(0,n.useEffect)(()=>{r();let e=setInterval(r,3e5);return()=>clearInterval(e)},[r]);let c=(0,n.useCallback)((e,t,a,i)=>{let n=new CustomEvent("event-status-changed",{detail:{eventId:e,eventName:t,oldStatus:a,newStatus:i,timestamp:new Date().toISOString()}});window.dispatchEvent(n)},[]),o=(0,n.useCallback)((e,t)=>{let a=new CustomEvent("auto-status-completed",{detail:{type:e,result:t,timestamp:new Date().toISOString()}});window.dispatchEvent(a)},[]),d=(0,n.useCallback)((e,a)=>{t({title:e,description:a})},[t]);return{notifications:a,setNotifications:i,triggerStatusChange:c,triggerAutoStatus:o,showSuccess:d,showError:(0,n.useCallback)((e,a)=>{t({title:e,description:a,variant:"destructive"})},[t]),showWarning:(0,n.useCallback)((e,a)=>{t({title:e,description:a})},[t]),showInfo:(0,n.useCallback)((e,a)=>{t({title:e,description:a})},[t]),generateTimelineNotifications:r}}(t),x=e=>{if(!c.showToasts)return;let t="toast-".concat(Date.now(),"-").concat(Math.random()),a={...e,id:t,onDismiss:b};r(e=>[a,...e].slice(0,5)),c.soundEnabled&&("high"===e.priority||"urgent"===e.priority)&&k()},b=e=>{r(t=>t.filter(t=>t.id!==e))},k=()=>{try{let e=new Audio("/notification-sound.mp3");e.volume=.3,e.play().catch(()=>{})}catch(e){}};return(0,n.useEffect)(()=>{let e=()=>{let e=new Date,a=e.toDateString();t.forEach(t=>{let i=new Date(t.date),n=Math.floor((e.getTime()-i.getTime())/864e5);"draft"===t.status&&i.toDateString()===a&&x({type:"warning",title:"\uD83D\uDEA8 Event Hari Ini Belum Aktif!",message:'Event "'.concat(t.name,'" hari ini masih berstatus draft.'),priority:"urgent",persistent:!0,action:{label:"Aktifkan Sekarang",callback:()=>{s&&(s(t.id,"active"),u(t.id,t.name,"draft","active"))}},secondaryAction:{label:"Lihat Event",callback:()=>window.open("/event/".concat(t.id),"_blank")}}),"active"===t.status&&n>1&&x({type:"warning",title:"⏰ Event Aktif Sudah Lewat",message:'Event "'.concat(t.name,'" masih aktif padahal sudah ').concat(n," hari lewat."),priority:"high",action:{label:"Selesaikan",callback:()=>{s&&(s(t.id,"completed"),u(t.id,t.name,"active","completed"))}}}),"completed"===t.status&&n>7&&!t.is_archived&&x({type:"info",title:"\uD83D\uDCE6 Siap untuk Archive",message:'Event "'.concat(t.name,'" sudah selesai ').concat(n," hari."),priority:"medium",action:{label:"Arsipkan",callback:()=>{s&&(s(t.id,"archived"),u(t.id,t.name,"completed","archived"))}}}),"active"===t.status&&0===t.photo_count&&0===t.message_count&&n>=0&&x({type:"info",title:"\uD83D\uDCCA Event Tidak Ada Aktivitas",message:'Event "'.concat(t.name,'" aktif tapi belum ada interaksi tamu.'),priority:"low",duration:8e3})});let i=t.filter(e=>"active"===e.status).length;t.filter(e=>"completed"===e.status).length,i>5&&x({type:"warning",title:"⚡ Banyak Event Aktif",message:"".concat(i," event aktif. Pertimbangkan menyelesaikan yang sudah lewat."),priority:"medium",action:{label:"Auto Complete",callback:()=>{fetch("/api/admin/events/auto-status?action=auto-complete").then(e=>e.json()).then(e=>{m("auto-complete",e),h("Auto Complete Selesai","".concat(e.processed," event diselesaikan"))})}}})};e();let a=setInterval(e,6e5);return()=>clearInterval(a)},[t,s,u,m,h]),(0,n.useEffect)(()=>{let e=e=>{let{eventName:t,oldStatus:a,newStatus:i}=e.detail,n={"draft->active":{icon:"\uD83C\uDF89",title:"Event Diaktifkan!",type:"success"},"active->paused":{icon:"⏸️",title:"Event Dijeda",type:"warning"},"paused->active":{icon:"▶️",title:"Event Dilanjutkan",type:"info"},"active->completed":{icon:"✅",title:"Event Selesai!",type:"success"},"completed->archived":{icon:"\uD83D\uDCE6",title:"Event Diarsipkan",type:"info"},"active->cancelled":{icon:"❌",title:"Event Dibatalkan",type:"error"}}["".concat(a,"->").concat(i)];n&&x({type:n.type,title:n.title,message:'Event "'.concat(t,'" berhasil diubah statusnya.'),icon:n.icon,priority:"error"===n.type?"high":"medium",duration:6e3})};return window.addEventListener("event-status-changed",e),()=>{window.removeEventListener("event-status-changed",e)}},[]),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(C,{events:t,onRefresh:a}),(0,i.jsx)(g,{toasts:l,onDismiss:b}),(0,i.jsx)("div",{style:{display:"none"},children:(0,i.jsx)("div",{"data-notification-manager":"true","data-methods":JSON.stringify({addToast:"addToast",showSuccess:"showSuccess",showError:"showError",showWarning:"showWarning",showInfo:"showInfo",handleAutoStatusResult:"handleAutoStatusResult"})})})]})}}}]);