"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[603],{8526:function(e,t,n){n.d(t,{r:function(){return r}});var s=n(881),o=n(4149),a=n(2227),c=n(6756);let r=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,s.jsx)(a.fC,{className:(0,c.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",n),...o,ref:t,children:(0,s.jsx)(a.bU,{className:(0,c.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});r.displayName=a.fC.displayName},7825:function(e,t,n){n.d(t,{PD:function(){return l},Uj:function(){return i},BC:function(){return u}});var s=n(4149),o=n(3499);class a{connect(){if(!this.url){console.log("\uD83D\uDEAB WebSocket connection skipped - no URL provided");return}if(!this.isConnecting&&(!this.ws||this.ws.readyState!==WebSocket.CONNECTING)){this.isConnecting=!0,console.log("\uD83D\uDD0C Connecting to WebSocket server:",this.url);try{this.ws=new WebSocket(this.url),this.setupEventListeners()}catch(e){console.error("❌ WebSocket connection error:",e),this.handleReconnect()}}}setupEventListeners(){this.ws&&(this.ws.onopen=()=>{console.log("✅ WebSocket connected"),this.isConnecting=!1,this.reconnectAttempts=0,this.reconnectDelay=1e3,this.startHeartbeat(),this.sendQueuedMessages(),this.emit("connected",{timestamp:new Date().toISOString()})},this.ws.onmessage=e=>{try{let t=JSON.parse(e.data);console.log("\uD83D\uDCE8 WebSocket message received:",t),this.handleMessage(t)}catch(e){console.error("❌ Error parsing WebSocket message:",e)}},this.ws.onclose=e=>{console.log("\uD83D\uDD0C WebSocket disconnected:",e.code,e.reason),this.isConnecting=!1,this.stopHeartbeat(),this.emit("disconnected",{code:e.code,reason:e.reason,timestamp:new Date().toISOString()}),1e3!==e.code&&this.handleReconnect()},this.ws.onerror=e=>{console.error("❌ WebSocket error:",e),this.emit("error",{error:e,timestamp:new Date().toISOString()})})}handleMessage(e){let{type:t,payload:n}=e;switch(t){case"notification":this.handleNotification(n);break;case"upload_progress":this.handleUploadProgress(n);break;case"camera_status":this.handleCameraStatus(n);break;case"system_status":this.handleSystemStatus(n);break;case"heartbeat_response":break;default:console.log("\uD83E\uDD37 Unknown message type:",t)}this.emit(t,n)}handleNotification(e){let{type:t,title:n,message:s,priority:a,showToast:c=!0,persistent:r=!1,data:i={}}=e;if(c){let e={persistent:r||"critical"===a,duration:"critical"===a?0:"high"===a?8e3:5e3};switch(t){case"upload_success":o.Am.upload(n,s,e);break;case"upload_failed":o.Am.error(n,s,e);break;case"camera_disconnected":o.Am.camera(n,s,e);break;case"storage_warning":o.Am.warning(n,s,e);break;case"event_milestone":o.Am.success(n,s,e);break;default:o.Am.info(n,s,e)}}("critical"===a||"high"===a)&&this.playNotificationSound(),"vibrator"in navigator&&("critical"===a||"high"===a)&&navigator.vibrate([200,100,200])}handleUploadProgress(e){let{fileName:t,progress:n,total:s,status:a}=e;"completed"===a?o.Am.success("Upload Complete","".concat(t," uploaded successfully")):"failed"===a&&o.Am.error("Upload Failed","Failed to upload ".concat(t))}handleCameraStatus(e){let{status:t,cameraModel:n,message:s}=e;"connected"===t?o.Am.camera("Camera Connected","".concat(n," is ready for shooting")):"disconnected"===t&&o.Am.camera("Camera Disconnected",s||"Please check USB connection",{persistent:!0})}handleSystemStatus(e){let{status:t,message:n,data:s}=e;"storage_warning"===t?o.Am.warning("Storage Warning","".concat(s.percentage,"% storage remaining"),{persistent:!0}):"backup_complete"===t&&o.Am.success("Backup Complete",n)}send(e,t){let n={type:e,payload:t,timestamp:new Date().toISOString(),id:"msg_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))};this.ws&&this.ws.readyState===WebSocket.OPEN?(this.ws.send(JSON.stringify(n)),console.log("\uD83D\uDCE4 WebSocket message sent:",n)):(this.messageQueue.push(n),console.log("\uD83D\uDCE6 Message queued (WebSocket not ready):",n))}sendQueuedMessages(){for(;this.messageQueue.length>0;){let e=this.messageQueue.shift();e&&this.ws&&this.ws.readyState===WebSocket.OPEN&&(this.ws.send(JSON.stringify(e)),console.log("\uD83D\uDCE4 Queued message sent:",e))}}startHeartbeat(){this.heartbeatInterval=setInterval(()=>{this.send("heartbeat",{timestamp:new Date().toISOString()})},3e4)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}handleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("❌ Max reconnection attempts reached"),this.emit("max_reconnect_attempts",{attempts:this.reconnectAttempts});return}this.reconnectAttempts++,console.log("\uD83D\uDD04 Reconnecting... (attempt ".concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")")),setTimeout(()=>{this.connect()},this.reconnectDelay),this.reconnectDelay=Math.min(2*this.reconnectDelay,3e4)}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){let n=this.listeners.get(e);if(n){let e=n.indexOf(t);e>-1&&n.splice(e,1)}}emit(e,t){let n=this.listeners.get(e);n&&n.forEach(e=>{try{e(t)}catch(e){console.error("❌ Error in event listener:",e)}})}playNotificationSound(){try{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),n=e.createGain();t.connect(n),n.connect(e.destination),t.frequency.value=800,t.type="sine",n.gain.value=.1,t.start(),t.stop(e.currentTime+.2)}catch(e){console.warn("⚠️ Could not play notification sound:",e)}}getStatus(){if(!this.ws)return"disconnected";switch(this.ws.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"disconnected";default:return"unknown"}}close(){this.stopHeartbeat(),this.ws&&(this.ws.close(1e3,"Client closing connection"),this.ws=null)}reconnect(){this.close(),this.reconnectAttempts=0,this.reconnectDelay=1e3,this.connect()}constructor(e=""){if(this.url=e,this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.heartbeatInterval=null,this.isConnecting=!1,this.listeners=new Map,this.messageQueue=[],"localhost"!==window.location.hostname){console.log("\uD83D\uDEAB WebSocket disabled in production environment");return}this.connect()}}let c=null;function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{channels:t=[],autoConnect:n=!0,onMessage:o,onConnect:r,onDisconnect:i,onError:l}=e,[u,d]=(0,s.useState)({isConnected:!1,isConnecting:!1,error:null,lastMessage:null,connectionAttempts:0}),h=(0,s.useRef)((c||(c=new a("localhost"===window.location.hostname?"ws://localhost:3001":"")),c)),p=(0,s.useRef)(new Set),g=(0,s.useCallback)(e=>{p.current.has(e)||(p.current.add(e),h.current.send("subscribe",{channel:e}),console.log("\uD83D\uDCE1 Subscribed to channel: ".concat(e)))},[]),m=(0,s.useCallback)(e=>{p.current.has(e)&&(p.current.delete(e),h.current.send("unsubscribe",{channel:e}),console.log("\uD83D\uDCE1 Unsubscribed from channel: ".concat(e)))},[]),f=(0,s.useCallback)((e,t)=>{h.current.send(e,t)},[]),b=(0,s.useCallback)(e=>{h.current.send("get_status",{channel:e})},[]);return(0,s.useEffect)(()=>{let e=h.current,n=()=>{d(e=>({...e,isConnected:!0,isConnecting:!1,error:null})),t.forEach(e=>g(e)),null==r||r()},s=e=>{d(t=>({...t,isConnected:!1,isConnecting:!1,error:e.reason||"Connection lost"})),p.current.clear(),null==i||i()},a=e=>{d(t=>{var n;return{...t,error:(null===(n=e.error)||void 0===n?void 0:n.message)||"WebSocket error",isConnecting:!1}}),null==l||l(e.error)},c=e=>{d(t=>({...t,lastMessage:{type:"message",payload:e,timestamp:new Date().toISOString()}})),null==o||o({type:"message",payload:e,timestamp:new Date().toISOString()})};return e.on("connected",n),e.on("disconnected",s),e.on("error",a),e.on("dslr_status",c),e.on("backup_status",c),e.on("backup_progress",c),e.on("camera_status",c),e.on("upload_progress",c),e.on("notification",c),()=>{e.off("connected",n),e.off("disconnected",s),e.off("error",a),e.off("dslr_status",c),e.off("backup_status",c),e.off("backup_progress",c),e.off("camera_status",c),e.off("upload_progress",c),e.off("notification",c)}},[t,g,r,i,l,o]),(0,s.useEffect)(()=>{!n||u.isConnected||u.isConnecting||d(e=>({...e,isConnecting:!0}))},[n,u.isConnected,u.isConnecting]),{isConnected:u.isConnected,isConnecting:u.isConnecting,error:u.error,lastMessage:u.lastMessage,connectionAttempts:u.connectionAttempts,subscribe:g,unsubscribe:m,sendMessage:f,getCurrentStatus:b,reconnect:()=>h.current.reconnect(),disconnect:()=>h.current.close(),getConnectionStatus:()=>h.current.getStatus()}}function i(){let[e,t]=(0,s.useState)(null),[n,o]=(0,s.useState)(null),[a,c]=(0,s.useState)(null),{isConnected:i,subscribe:l,unsubscribe:u,getCurrentStatus:d}=r({channels:["dslr"],onMessage:e=>{var n;switch((null===(n=e.payload)||void 0===n?void 0:n.type)||e.type){case"dslr_status":t(e.payload);break;case"camera_status":o(e.payload);break;case"upload_progress":c(e.payload)}}});return(0,s.useEffect)(()=>{i&&d("dslr")},[i,d]),{isConnected:i,dslrStatus:e,cameraStatus:n,uploadProgress:a,subscribe:l,unsubscribe:u,refreshStatus:()=>d("dslr"),transport:"websocket",connectionMode:i?"realtime":"polling",error:null,isRealTimeEnabled:!0,notifications:[],toggleRealTime:()=>{},clearNotifications:()=>{}}}function l(){let[e,t]=(0,s.useState)(null),[n,o]=(0,s.useState)(null),[a,c]=(0,s.useState)([]),{isConnected:i,subscribe:l,unsubscribe:u,getCurrentStatus:d}=r({channels:["backup"],onMessage:e=>{var n,s,a;switch((null===(n=e.payload)||void 0===n?void 0:n.type)||e.type){case"backup_status":t(e.payload);break;case"backup_progress":o(e.payload);break;case"notification":(null===(a=e.payload)||void 0===a?void 0:null===(s=a.type)||void 0===s?void 0:s.includes("backup"))&&c(t=>[e.payload,...t.slice(0,9)])}}});return(0,s.useEffect)(()=>{i&&d("backup")},[i,d]),{isConnected:i,backupStatus:e,backupProgress:n,notifications:a,subscribe:l,unsubscribe:u,refreshStatus:()=>d("backup"),clearNotifications:()=>c([])}}function u(){let[e,t]=(0,s.useState)([]),[n,o]=(0,s.useState)([]),{isConnected:a}=r({channels:["system","dslr","backup"],onMessage:e=>{var n;if((null===(n=e.payload)||void 0===n?void 0:n.type)==="notification"){let n=e.payload;t(e=>[n,...e.slice(0,19)]),"critical"===n.priority&&o(e=>[n,...e.slice(0,4)])}}}),c=(0,s.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[]),i=(0,s.useCallback)(e=>{o(t=>t.filter(t=>t.id!==e))},[]),l=(0,s.useCallback)(()=>{t([])},[]);return{isConnected:a,notifications:e,criticalAlerts:n,dismissNotification:c,dismissCriticalAlert:i,clearAllNotifications:l,hasUnreadCritical:n.length>0,unreadCount:e.length,markAsRead:()=>{},clearNotifications:l}}}}]);