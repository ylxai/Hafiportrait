"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1508],{1508:function(e,t,s){s.r(t),s.d(t,{AlertDashboard:function(){return S}});var a=s(881),i=s(4149),l=s(3575),r=s(3939),n=s(5949),c=s(5477),o=s(1756),d=s(8943),m=s(4581),h=s(1664),u=s(9188),x=s(313),f=s(5876),v=s(2436),g=s(3377),p=s(7324),y=s(6077),j=s(9674),b=s(3784),N=s(8544);class w{initializeDefaultRules(){[{id:"high-error-rate",name:"High Error Rate",condition:"error_rate > threshold",threshold:5,severity:"critical",category:"system",enabled:!0,cooldown:15,escalationRules:[{level:1,delayMinutes:0,channels:["slack","email"],recipients:["dev-team"]},{level:2,delayMinutes:15,channels:["slack","email","sms"],recipients:["dev-team","ops-team"]}]},{id:"high-response-time",name:"High Response Time",condition:"avg_response_time > threshold",threshold:2e3,severity:"high",category:"performance",enabled:!0,cooldown:10,escalationRules:[{level:1,delayMinutes:0,channels:["slack"],recipients:["dev-team"]}]},{id:"storage-usage-high",name:"Storage Usage High",condition:"storage_usage > threshold",threshold:85,severity:"medium",category:"system",enabled:!0,cooldown:60,escalationRules:[{level:1,delayMinutes:0,channels:["slack","email"],recipients:["ops-team"]}]},{id:"failed-uploads",name:"High Upload Failure Rate",condition:"upload_failure_rate > threshold",threshold:10,severity:"high",category:"business",enabled:!0,cooldown:5,escalationRules:[{level:1,delayMinutes:0,channels:["slack","email"],recipients:["dev-team","business-team"]}]},{id:"security-breach-attempt",name:"Security Breach Attempt",condition:"failed_login_attempts > threshold",threshold:10,severity:"critical",category:"security",enabled:!0,cooldown:1,escalationRules:[{level:1,delayMinutes:0,channels:["slack","email","sms"],recipients:["security-team","dev-team"]}]}].forEach(e=>this.rules.set(e.id,e))}initializeDefaultChannels(){var e;[{type:"slack",config:{webhookUrl:N.env.SLACK_WEBHOOK_URL,channel:"#alerts",username:"HafiPortrait Alert Bot"},enabled:!!N.env.SLACK_WEBHOOK_URL},{type:"email",config:{smtpHost:N.env.SMTP_HOST,smtpPort:N.env.SMTP_PORT,smtpUser:N.env.SMTP_USER,smtpPass:N.env.SMTP_PASS,fromEmail:N.env.ALERT_FROM_EMAIL||"alerts@hafiportrait.com"},enabled:!!N.env.SMTP_HOST},{type:"webhook",config:{url:N.env.ALERT_WEBHOOK_URL,headers:{Authorization:"Bearer ".concat(N.env.ALERT_WEBHOOK_TOKEN),"Content-Type":"application/json"}},enabled:!!N.env.ALERT_WEBHOOK_URL},{type:"whatsapp",config:{apiUrl:N.env.WHATSAPP_API_URL,token:N.env.WHATSAPP_API_TOKEN,phoneNumbers:(null===(e=N.env.WHATSAPP_ALERT_NUMBERS)||void 0===e?void 0:e.split(","))||[]},enabled:!!N.env.WHATSAPP_API_URL}].forEach(e=>this.channels.set(e.type,e))}async createAlert(e){let t={...e,id:this.generateAlertId(),timestamp:new Date,escalationLevel:0,resolved:!1},s="".concat(t.source,"-").concat(t.category),a=this.cooldowns.get(s);return a&&Date.now()-a.getTime()<6e4?console.log("Alert ".concat(t.id," suppressed due to cooldown")):(this.alerts.set(t.id,t),this.cooldowns.set(s,new Date),await this.processAlert(t)),t}async processAlert(e){try{for(let t of Array.from(this.rules.values()).filter(t=>t.enabled&&t.category===e.category))if(this.evaluateRule(t,e)){await this.executeEscalation(e,t,0);break}console.log("\uD83D\uDEA8 Alert created: ".concat(e.title," [").concat(e.severity,"]"))}catch(e){console.error("Error processing alert:",e)}}evaluateRule(e,t){return t.severity===e.severity||"critical"===e.severity&&["critical","high"].includes(t.severity)}async executeEscalation(e,t,s){let a=t.escalationRules[s];if(a&&(0===a.delayMinutes&&await this.sendNotifications(e,a),s+1<t.escalationRules.length)){let a=setTimeout(async()=>{e.resolved||(e.escalationLevel=s+1,await this.executeEscalation(e,t,s+1))},6e4*t.escalationRules[s+1].delayMinutes);this.escalationTimers.set("".concat(e.id,"-").concat(s+1),a)}}async sendNotifications(e,t){let s=t.channels.map(async s=>{let a=this.channels.get(s);if(a&&a.enabled)try{switch(s){case"slack":await this.sendSlackNotification(e,a);break;case"email":await this.sendEmailNotification(e,a,t.recipients);break;case"webhook":await this.sendWebhookNotification(e,a);break;case"whatsapp":await this.sendWhatsAppNotification(e,a)}}catch(e){console.error("Failed to send ".concat(s," notification:"),e)}});await Promise.allSettled(s)}async sendSlackNotification(e,t){let s=this.getSeverityColor(e.severity),a={channel:t.config.channel,username:t.config.username,attachments:[{color:s,title:"\uD83D\uDEA8 ".concat(e.title),text:e.message,fields:[{title:"Severity",value:e.severity.toUpperCase(),short:!0},{title:"Category",value:e.category,short:!0},{title:"Source",value:e.source,short:!0},{title:"Time",value:e.timestamp.toISOString(),short:!0}],footer:"HafiPortrait Alert System",ts:Math.floor(e.timestamp.getTime()/1e3)}]};await fetch(t.config.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}async sendEmailNotification(e,t,s){console.log("\uD83D\uDCE7 Email notification sent for alert: ".concat(e.id))}async sendWebhookNotification(e,t){await fetch(t.config.url,{method:"POST",headers:t.config.headers,body:JSON.stringify({alert:e,timestamp:new Date().toISOString(),source:"hafiportrait-alert-manager"})})}async sendWhatsAppNotification(e,t){let s="\uD83D\uDEA8 *HafiPortrait Alert*\n\n*".concat(e.title,"*\n").concat(e.message,"\n\nSeverity: ").concat(e.severity.toUpperCase(),"\nTime: ").concat(e.timestamp.toLocaleString());for(let e of t.config.phoneNumbers)await fetch(t.config.apiUrl,{method:"POST",headers:{Authorization:"Bearer ".concat(t.config.token),"Content-Type":"application/json"},body:JSON.stringify({to:e,message:s})})}async resolveAlert(e,t){let s=this.alerts.get(e);if(!s)return!1;for(let[a,i]of(s.resolved=!0,s.resolvedAt=new Date,s.resolvedBy=t,this.escalationTimers.entries()))a.startsWith(e)&&(clearTimeout(i),this.escalationTimers.delete(a));return console.log("âœ… Alert resolved: ".concat(s.title," by ").concat(t)),!0}getMetrics(){let e=Array.from(this.alerts.values()),t=Date.now(),s=e.filter(e=>t-e.timestamp.getTime()<864e5),a=e.filter(e=>e.resolved),i=a.filter(e=>e.resolvedAt).map(e=>e.resolvedAt.getTime()-e.timestamp.getTime());return{totalAlerts:s.length,criticalAlerts:s.filter(e=>"critical"===e.severity).length,resolvedAlerts:a.length,averageResolutionTime:i.length>0?i.reduce((e,t)=>e+t,0)/i.length:0,alertsByCategory:this.groupBy(s,"category"),alertsBySeverity:this.groupBy(s,"severity")}}getAlerts(e){let t=Array.from(this.alerts.values());return e&&(e.severity&&(t=t.filter(t=>t.severity===e.severity)),e.category&&(t=t.filter(t=>t.category===e.category)),void 0!==e.resolved&&(t=t.filter(t=>t.resolved===e.resolved)),e.limit&&(t=t.slice(0,e.limit))),t.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime())}generateAlertId(){return"alert_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}getSeverityColor(e){return({critical:"#FF0000",high:"#FF6600",medium:"#FFAA00",low:"#FFDD00",info:"#00AA00"})[e]||"#808080"}groupBy(e,t){return e.reduce((e,s)=>{let a=String(s[t]);return e[a]=(e[a]||0)+1,e},{})}constructor(){this.alerts=new Map,this.rules=new Map,this.channels=new Map,this.cooldowns=new Map,this.escalationTimers=new Map,this.initializeDefaultRules(),this.initializeDefaultChannels()}}let A=new w;function S(e){let{className:t}=e,[s,N]=(0,i.useState)([]),[w,S]=(0,i.useState)(null),[T,R]=(0,i.useState)("all"),[E,_]=(0,i.useState)(!0),[C,k]=(0,i.useState)(!0),P=(0,i.useCallback)(async()=>{try{_(!0);let e={};"critical"===T?e={severity:"critical"}:"unresolved"===T&&(e={resolved:!1});let t=A.getAlerts(e),s=A.getMetrics();N(t),S(s)}catch(e){console.error("Error loading alert data:",e)}finally{_(!1)}},[T]);(0,i.useEffect)(()=>{if(P(),C){let e=setInterval(P,3e4);return()=>clearInterval(e)}},[T,C,P]);let D=async e=>{try{await A.resolveAlert(e,"admin-user"),await P()}catch(e){console.error("Error resolving alert:",e)}},O=e=>({critical:"destructive",high:"destructive",medium:"default",low:"secondary",info:"outline"})[e]||"default",Z=e=>{let t={system:d.Z,performance:m.Z,security:h.Z,business:u.Z,user:x.Z}[e]||f.Z;return(0,a.jsx)(t,{className:"h-4 w-4"})};return E&&!w?(0,a.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,a.jsx)(v.Z,{className:"h-6 w-6 animate-spin mr-2"}),(0,a.jsx)("span",{children:"Loading alert dashboard..."})]}):(0,a.jsxs)("div",{className:"space-y-6 ".concat(t),children:[w&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Alerts (24h)"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:w.totalAlerts})]}),(0,a.jsx)(g.Z,{className:"h-8 w-8 text-blue-500"})]})})}),(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Critical Alerts"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-red-600",children:w.criticalAlerts})]}),(0,a.jsx)(f.Z,{className:"h-8 w-8 text-red-500"})]})})}),(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Resolved"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:w.resolvedAlerts})]}),(0,a.jsx)(p.Z,{className:"h-8 w-8 text-green-500"})]})})}),(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg Resolution"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[Math.round(w.averageResolutionTime/6e4),"m"]})]}),(0,a.jsx)(y.Z,{className:"h-8 w-8 text-orange-500"})]})})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Filter:"}),(0,a.jsx)("div",{className:"flex space-x-1",children:["all","critical","unresolved"].map(e=>(0,a.jsx)(n.z,{variant:T===e?"default":"outline",size:"sm",onClick:()=>R(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>k(!C),children:[C?(0,a.jsx)(b.Z,{className:"h-4 w-4"}):(0,a.jsx)(g.Z,{className:"h-4 w-4"}),C?"Disable":"Enable"," Auto-refresh"]}),(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:P,disabled:E,children:[(0,a.jsx)(v.Z,{className:"h-4 w-4 ".concat(E?"animate-spin":"")}),"Refresh"]})]})]}),(0,a.jsxs)(o.mQ,{defaultValue:"alerts",className:"w-full",children:[(0,a.jsxs)(o.dr,{children:[(0,a.jsx)(o.SP,{value:"alerts",children:"Active Alerts"}),(0,a.jsx)(o.SP,{value:"analytics",children:"Analytics"}),(0,a.jsx)(o.SP,{value:"settings",children:"Settings"})]}),(0,a.jsx)(o.nU,{value:"alerts",className:"space-y-4",children:0===s.length?(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.aY,{className:"p-8 text-center",children:[(0,a.jsx)(p.Z,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Active Alerts"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"All systems are running smoothly. Great job! \uD83C\uDF89"})]})}):(0,a.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,a.jsx)(l.Zb,{className:"border-l-4 ".concat("critical"===e.severity?"border-l-red-500":"high"===e.severity?"border-l-orange-500":"medium"===e.severity?"border-l-yellow-500":"border-l-blue-500"),children:(0,a.jsx)(l.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[Z(e.category),(0,a.jsx)("h4",{className:"font-semibold",children:e.title}),(0,a.jsx)(r.C,{variant:O(e.severity),children:e.severity.toUpperCase()}),e.resolved&&(0,a.jsx)(r.C,{variant:"outline",className:"text-green-600",children:"RESOLVED"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.message}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[(0,a.jsxs)("span",{children:["Source: ",e.source]}),(0,a.jsxs)("span",{children:["Category: ",e.category]}),(0,a.jsxs)("span",{children:["Time: ",e.timestamp.toLocaleString()]}),e.escalationLevel>0&&(0,a.jsxs)("span",{className:"text-orange-600",children:["Escalation Level: ",e.escalationLevel]})]}),e.tags.length>0&&(0,a.jsx)("div",{className:"flex items-center space-x-1 mt-2",children:e.tags.map(e=>(0,a.jsx)(r.C,{variant:"outline",className:"text-xs",children:e},e))})]}),(0,a.jsx)("div",{className:"flex flex-col space-y-2",children:!e.resolved&&(0,a.jsxs)(n.z,{size:"sm",onClick:()=>D(e.id),children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-1"}),"Resolve"]})})]})})},e.id))})}),(0,a.jsx)(o.nU,{value:"analytics",className:"space-y-4",children:w&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"Alerts by Category"})}),(0,a.jsx)(l.aY,{children:(0,a.jsx)("div",{className:"space-y-2",children:Object.entries(w.alertsByCategory).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[Z(t),(0,a.jsx)("span",{className:"capitalize",children:t})]}),(0,a.jsx)(r.C,{variant:"outline",children:s})]},t)})})})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"Alerts by Severity"})}),(0,a.jsx)(l.aY,{children:(0,a.jsx)("div",{className:"space-y-2",children:Object.entries(w.alertsBySeverity).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"capitalize",children:t}),(0,a.jsx)(r.C,{variant:O(t),children:s})]},t)})})})]})]})}),(0,a.jsx)(o.nU,{value:"settings",className:"space-y-4",children:(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"Alert Configuration"})}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)(c.bZ,{children:[(0,a.jsx)(f.Z,{className:"h-4 w-4"}),(0,a.jsx)(c.X,{children:"Alert configuration is managed through environment variables and the alert manager. Contact your system administrator to modify alert rules and notification channels."})]})})]})})]})]})}},1756:function(e,t,s){s.d(t,{SP:function(){return o},dr:function(){return c},mQ:function(){return n},nU:function(){return d}});var a=s(881),i=s(4149),l=s(1340),r=s(6756);let n=l.fC,c=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,a.jsx)(l.aV,{ref:t,className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...i})});c.displayName=l.aV.displayName;let o=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,a.jsx)(l.xz,{ref:t,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...i})});o.displayName=l.xz.displayName;let d=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,a.jsx)(l.VY,{ref:t,className:(0,r.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...i})});d.displayName=l.VY.displayName}}]);