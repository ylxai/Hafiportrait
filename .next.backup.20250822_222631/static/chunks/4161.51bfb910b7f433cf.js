"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4161],{5939:function(e,s,t){t.d(s,{Z:function(){return a}});let a=(0,t(5931).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},5409:function(e,s,t){t.d(s,{Z:function(){return a}});let a=(0,t(5931).Z)("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]])},4348:function(e,s,t){t.r(s),t.d(s,{BackupStatusMonitor:function(){return k}});var a=t(881),l=t(4149),c=t(3575),n=t(3939),i=t(5949),r=t(3559),o=t(5477),d=t(8526),m=t(7825),x=t(7324),u=t(1935),h=t(2436),p=t(6077),f=t(9053),j=t(4581),g=t(2828),N=t(5409),b=t(5939),v=t(2238);function k(){let{isConnected:e,backupStatus:s,backupProgress:t,notifications:k,refreshStatus:w,clearNotifications:y}=(0,m.PD)(),[B,C]=(0,l.useState)(null),[Z,D]=(0,l.useState)([]),[z,S]=(0,l.useState)(!0),[P,U]=(0,l.useState)(null),[M,E]=(0,l.useState)(!0),[F,R]=(0,l.useState)(!0),[A,T]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(F&&s){console.log("\uD83D\uDD04 Updating backup status from WebSocket:",s);let e=Array.isArray(s)?s:[];C({totalBackups:e.length,activeBackups:e.filter(e=>"backing_up"===e.status||"initializing"===e.status).length,completedBackups:e.filter(e=>"completed"===e.status).length,failedBackups:e.filter(e=>"failed"===e.status).length,totalPhotosBackedUp:e.reduce((e,s)=>e+(s.successfulUploads||0),0),totalPhotosFailed:e.reduce((e,s)=>e+(s.failedUploads||0),0)}),D(e.sort((e,s)=>new Date(s.startTime).getTime()-new Date(e.startTime).getTime()).slice(0,10)),S(!1)}},[s,F]),(0,l.useEffect)(()=>{t&&(console.log("\uD83D\uDCCA Backup progress update:",t),D(e=>e.map(e=>e.backupId===t.backupId?{...e,status:t.status,processedPhotos:t.processedPhotos,successfulUploads:t.successfulUploads,failedUploads:t.failedUploads}:e)))},[t]);let I=(0,l.useCallback)(async()=>{try{U(null),T(!0);let s=await fetch("/api/admin/backup/status"),t=await s.json();if(t.success)F&&e||(C(t.data.summary),D(t.data.recentBackups));else throw Error(t.message||"Failed to load backup status")}catch(e){U("Failed to load backup status: ".concat(e.message))}finally{S(!1),T(!1)}},[F,e]);(0,l.useEffect)(()=>{let s;if(I(),M){let t=()=>F&&e?(null==B?void 0:B.activeBackups)&&B.activeBackups>0?15e3:6e4:(null==B?void 0:B.activeBackups)&&B.activeBackups>0?3e3:1e4;(()=>{let a=t();s=setInterval(()=>{F&&e?(null==B?void 0:B.activeBackups)&&B.activeBackups>0&&w():I()},a),console.log("\uD83D\uDCCA Backup Status Monitor polling: ".concat(a,"ms (").concat((null==B?void 0:B.activeBackups)||0," active backups)"))})()}return()=>{s&&clearInterval(s)}},[M,F,e,null==B?void 0:B.activeBackups,I,w]);let O=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;try{let s=await fetch("/api/admin/backup/status?maxAge=".concat(e),{method:"DELETE"});(await s.json()).success&&await I()}catch(e){console.error("Failed to cleanup old backups:",e)}},_=e=>{switch(e){case"completed":return(0,a.jsx)(x.Z,{className:"h-4 w-4 text-green-500"});case"failed":return(0,a.jsx)(u.Z,{className:"h-4 w-4 text-red-500"});case"backing_up":case"initializing":return(0,a.jsx)(h.Z,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return(0,a.jsx)(p.Z,{className:"h-4 w-4 text-gray-500"})}},Y=e=>(0,a.jsxs)(n.C,{variant:{completed:"default",failed:"destructive",backing_up:"secondary",initializing:"secondary"}[e]||"outline",className:"flex items-center gap-1",children:[_(e),e.replace("_"," ").toUpperCase()]}),W=e=>0===e.totalPhotos?0:Math.round(e.processedPhotos/e.totalPhotos*100),G=e=>{let s=Math.round(e/1e3);return s<60?"".concat(s,"s"):"".concat(Math.floor(s/60),"m ").concat(s%60,"s")};return z?(0,a.jsx)(c.Zb,{children:(0,a.jsxs)(c.aY,{className:"flex items-center justify-center p-6",children:[(0,a.jsx)(h.Z,{className:"h-6 w-6 animate-spin mr-2"}),"Loading backup status..."]})}):(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[B&&(0,a.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[(0,a.jsx)(c.Zb,{className:"hover:shadow-md transition-shadow",children:(0,a.jsx)(c.aY,{className:"p-3 sm:p-4",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-600 truncate",children:"Total Backups"}),(0,a.jsx)("p",{className:"text-xl sm:text-2xl font-bold",children:B.totalBackups})]}),(0,a.jsx)(f.Z,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-500 flex-shrink-0"})]})})}),(0,a.jsx)(c.Zb,{className:"hover:shadow-md transition-shadow",children:(0,a.jsx)(c.aY,{className:"p-3 sm:p-4",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-600 truncate",children:"Active"}),(0,a.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:B.activeBackups})]}),(0,a.jsx)(j.Z,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-500 flex-shrink-0"})]})})}),(0,a.jsx)(c.Zb,{className:"hover:shadow-md transition-shadow",children:(0,a.jsx)(c.aY,{className:"p-3 sm:p-4",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-600 truncate",children:"Completed"}),(0,a.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-green-600",children:B.completedBackups})]}),(0,a.jsx)(x.Z,{className:"h-6 w-6 sm:h-8 sm:w-8 text-green-500 flex-shrink-0"})]})})}),(0,a.jsx)(c.Zb,{className:"hover:shadow-md transition-shadow",children:(0,a.jsx)(c.aY,{className:"p-3 sm:p-4",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-600 truncate",children:"Failed"}),(0,a.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-red-600",children:B.failedBackups})]}),(0,a.jsx)(u.Z,{className:"h-6 w-6 sm:h-8 sm:w-8 text-red-500 flex-shrink-0"})]})})})]}),P&&(0,a.jsxs)(o.bZ,{variant:"destructive",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4"}),(0,a.jsx)(o.X,{children:P})]}),(0,a.jsxs)(c.Zb,{children:[(0,a.jsx)(c.Ol,{className:"pb-3 sm:pb-6",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsxs)(c.ll,{className:"flex items-center gap-2 text-base sm:text-lg",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate",children:"Recent Backup Operations"}),F&&e&&(0,a.jsxs)(n.C,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-200",children:[(0,a.jsx)(g.Z,{className:"h-3 w-3 mr-1"}),"Real-time"]})]}),(0,a.jsxs)(c.SZ,{className:"text-xs sm:text-sm mt-1 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"Monitor ongoing and recent backup operations"}),(0,a.jsxs)(n.C,{variant:e?"default":"secondary",className:"text-xs",children:[(0,a.jsx)(N.Z,{className:"h-3 w-3 mr-1"}),e?"WebSocket":"Polling"]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-gray-50",children:[(0,a.jsx)(d.r,{checked:F,onCheckedChange:R}),(0,a.jsx)("span",{className:"text-xs font-medium",children:"Real-time"})]}),(0,a.jsxs)("div",{className:"flex gap-2 sm:hidden",children:[(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>E(!M),className:"flex-1 text-xs",children:[(0,a.jsx)(h.Z,{className:"h-3 w-3 mr-1 ".concat(M?"animate-spin":"")}),"Auto: ",M?"ON":"OFF"]}),(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>{F&&e?w():I()},disabled:A,className:"flex-1 text-xs",children:[(0,a.jsx)(h.Z,{className:"h-3 w-3 mr-1 ".concat(A?"animate-spin":"")}),"Refresh"]})]}),(0,a.jsxs)("div",{className:"flex gap-2 sm:hidden",children:[(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>O(),className:"flex-1 text-xs",children:[(0,a.jsx)(b.Z,{className:"h-3 w-3 mr-1"}),"Cleanup"]}),k.length>0&&(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:y,className:"flex-1 text-xs",children:["Clear (",k.length,")"]})]}),(0,a.jsxs)("div",{className:"hidden sm:flex gap-2",children:[(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>E(!M),className:"text-xs",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-1 ".concat(M?"animate-spin":"")}),"Auto Refresh: ",M?"ON":"OFF"]}),(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>{F&&e?w():I()},disabled:A,className:"text-xs",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-1 ".concat(A?"animate-spin":"")}),"Refresh"]}),(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>O(),className:"text-xs",children:[(0,a.jsx)(b.Z,{className:"h-4 w-4 mr-1"}),"Cleanup"]}),k.length>0&&(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:y,className:"text-xs",children:["Clear Notifications (",k.length,")"]})]})]})]})}),(0,a.jsx)(c.aY,{className:"p-3 sm:p-6",children:0===Z.length?(0,a.jsxs)("div",{className:"text-center py-6 sm:py-8 text-gray-500",children:[(0,a.jsx)(f.Z,{className:"h-8 w-8 sm:h-12 sm:w-12 mx-auto mb-3 sm:mb-4 opacity-50"}),(0,a.jsx)("p",{className:"text-sm sm:text-base",children:"No backup operations found"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm mt-1",children:"Start a backup from the event management page"})]}):(0,a.jsx)("div",{className:"space-y-3 sm:space-y-4",children:Z.map(e=>(0,a.jsxs)("div",{className:"border rounded-lg p-3 sm:p-4 space-y-3 hover:shadow-sm transition-shadow",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 min-w-0 flex-1",children:[(0,a.jsxs)("span",{className:"font-medium text-sm sm:text-base truncate",children:["Event: ",e.eventId]}),Y(e.status)]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-2",children:[e.googleDriveFolderUrl&&(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>window.open(e.googleDriveFolderUrl,"_blank"),className:"w-full sm:w-auto text-xs",children:[(0,a.jsx)(v.Z,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),"Google Drive"]}),(0,a.jsx)("span",{className:"text-xs sm:text-sm text-gray-500 self-start sm:self-center",children:new Date(e.startTime).toLocaleString("id-ID",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})})]})]}),"backing_up"===e.status&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(r.E,{value:W(e),className:"w-full h-2 sm:h-3"}),(0,a.jsxs)("div",{className:"flex justify-between text-xs sm:text-sm text-gray-600",children:[(0,a.jsxs)("span",{children:[e.processedPhotos," / ",e.totalPhotos," photos"]}),(0,a.jsxs)("span",{className:"font-medium",children:[W(e),"% complete"]})]})]}),"completed"===e.status&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 text-xs sm:text-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-1 sm:gap-4",children:[(0,a.jsxs)("span",{className:"text-green-600 font-medium",children:["✅ ",e.successfulUploads," photos backed up"]}),e.failedUploads>0&&(0,a.jsxs)("span",{className:"text-orange-600",children:["⚠️ ",e.failedUploads," failed"]})]}),e.duration&&(0,a.jsxs)("span",{className:"text-gray-500 text-xs",children:["Duration: ",G(e.duration)]})]}),"failed"===e.status&&(0,a.jsx)("div",{className:"text-xs sm:text-sm text-red-600 font-medium",children:"❌ Backup failed"})]},e.backupId))})})]}),B&&B.totalPhotosBackedUp>0&&(0,a.jsxs)(c.Zb,{className:"hover:shadow-md transition-shadow",children:[(0,a.jsx)(c.Ol,{className:"pb-3 sm:pb-6",children:(0,a.jsx)(c.ll,{className:"text-base sm:text-lg flex items-center gap-2",children:"\uD83D\uDCCA Backup Statistics"})}),(0,a.jsxs)(c.aY,{className:"p-3 sm:p-6 pt-0",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{className:"text-center p-3 sm:p-4 bg-green-50 rounded-lg border border-green-200 hover:bg-green-100 transition-colors",children:[(0,a.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-green-600",children:B.totalPhotosBackedUp}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-green-700 font-medium mt-1",children:"Total Photos Backed Up"})]}),(0,a.jsxs)("div",{className:"text-center p-3 sm:p-4 bg-red-50 rounded-lg border border-red-200 hover:bg-red-100 transition-colors",children:[(0,a.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-red-600",children:B.totalPhotosFailed}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-red-700 font-medium mt-1",children:"Total Photos Failed"})]}),(0,a.jsxs)("div",{className:"text-center p-3 sm:p-4 bg-blue-50 rounded-lg border border-blue-200 hover:bg-blue-100 transition-colors",children:[(0,a.jsxs)("p",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:[B.totalPhotosBackedUp>0?Math.round(B.totalPhotosBackedUp/(B.totalPhotosBackedUp+B.totalPhotosFailed)*100):0,"%"]}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-blue-700 font-medium mt-1",children:"Success Rate"})]})]}),(0,a.jsx)("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg border sm:hidden",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:"\uD83D\uDCBE Free Storage Used"}),(0,a.jsxs)("div",{className:"flex justify-center gap-4 text-xs",children:[(0,a.jsx)("span",{className:"text-blue-600 font-medium",children:"Google Drive: 15GB+"}),(0,a.jsx)("span",{className:"text-green-600 font-medium",children:"Cloudflare R2: 10GB"})]})]})})]})]})]})}},2227:function(e,s,t){t.d(s,{bU:function(){return w},fC:function(){return k}});var a=t(4149),l=t(2113),c=t(4828),n=t(3006),i=t(1232),r=t(5558),o=t(6340),d=t(8458),m=t(881),x="Switch",[u,h]=(0,n.b)(x),[p,f]=u(x),j=a.forwardRef((e,s)=>{let{__scopeSwitch:t,name:n,checked:r,defaultChecked:o,required:u,disabled:h,value:f="on",onCheckedChange:j,form:g,...N}=e,[k,w]=a.useState(null),y=(0,c.e)(s,e=>w(e)),B=a.useRef(!1),C=!k||g||!!k.closest("form"),[Z,D]=(0,i.T)({prop:r,defaultProp:null!=o&&o,onChange:j,caller:x});return(0,m.jsxs)(p,{scope:t,checked:Z,disabled:h,children:[(0,m.jsx)(d.WV.button,{type:"button",role:"switch","aria-checked":Z,"aria-required":u,"data-state":v(Z),"data-disabled":h?"":void 0,disabled:h,value:f,...N,ref:y,onClick:(0,l.Mj)(e.onClick,e=>{D(e=>!e),C&&(B.current=e.isPropagationStopped(),B.current||e.stopPropagation())})}),C&&(0,m.jsx)(b,{control:k,bubbles:!B.current,name:n,value:f,checked:Z,required:u,disabled:h,form:g,style:{transform:"translateX(-100%)"}})]})});j.displayName=x;var g="SwitchThumb",N=a.forwardRef((e,s)=>{let{__scopeSwitch:t,...a}=e,l=f(g,t);return(0,m.jsx)(d.WV.span,{"data-state":v(l.checked),"data-disabled":l.disabled?"":void 0,...a,ref:s})});N.displayName=g;var b=a.forwardRef((e,s)=>{let{__scopeSwitch:t,control:l,checked:n,bubbles:i=!0,...d}=e,x=a.useRef(null),u=(0,c.e)(x,s),h=(0,r.D)(n),p=(0,o.t)(l);return a.useEffect(()=>{let e=x.current;if(!e)return;let s=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(h!==n&&s){let t=new Event("click",{bubbles:i});s.call(e,n),e.dispatchEvent(t)}},[h,n,i]),(0,m.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...d,tabIndex:-1,ref:u,style:{...d.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function v(e){return e?"checked":"unchecked"}b.displayName="SwitchBubbleInput";var k=j,w=N},5558:function(e,s,t){t.d(s,{D:function(){return l}});var a=t(4149);function l(e){let s=a.useRef({value:e,previous:e});return a.useMemo(()=>(s.current.value!==e&&(s.current.previous=s.current.value,s.current.value=e),s.current.previous),[e])}},6340:function(e,s,t){t.d(s,{t:function(){return c}});var a=t(4149),l=t(3450);function c(e){let[s,t]=a.useState(void 0);return(0,l.b)(()=>{if(e){t({width:e.offsetWidth,height:e.offsetHeight});let s=new ResizeObserver(s=>{let a,l;if(!Array.isArray(s)||!s.length)return;let c=s[0];if("borderBoxSize"in c){let e=c.borderBoxSize,s=Array.isArray(e)?e[0]:e;a=s.inlineSize,l=s.blockSize}else a=e.offsetWidth,l=e.offsetHeight;t({width:a,height:l})});return s.observe(e,{box:"border-box"}),()=>s.unobserve(e)}t(void 0)},[e]),s}}}]);