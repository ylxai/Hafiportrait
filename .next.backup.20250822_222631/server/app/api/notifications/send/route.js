"use strict";(()=>{var t={};t.id=5285,t.ids=[5285],t.modules={20399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},80660:(t,e,n)=>{n.r(e),n.d(e,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var o={};n.r(o),n.d(o,{POST:()=>c});var i=n(30633),s=n(86488),r=n(13342),a=n(90223);async function c(t){try{let{title:e,message:n,type:o="general",priority:i="normal",recipients:s="all",data:r={},scheduled:c=null,topic:f=null}=await t.json();if(!e||!n)return a.NextResponse.json({success:!1,error:"Title and message are required"},{status:400});let g={id:`notif_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:e,body:n,icon:"/icons/icon-192x192.png",badge:"/icons/badge-72x72.png",image:r.imageUrl||null,data:{type:o,priority:i,url:r.url||"/admin",timestamp:new Date().toISOString(),...r},actions:[{action:"view",title:"Lihat"},{action:"dismiss",title:"Tutup"}]},m=[];if("all"===s)m=await u();else if(Array.isArray(s))m=s;else if(f)return await d(f,g),a.NextResponse.json({success:!0,data:{notificationId:g.id,type:"topic",topic:f,message:"Notification sent to topic successfully"}});let y=await l(m,g);return await p({...g,recipients:m.length,sentAt:new Date().toISOString(),results:y}),a.NextResponse.json({success:!0,data:{notificationId:g.id,type:"tokens",recipients:m.length,successful:y.successful,failed:y.failed,message:"Notification sent successfully"}})}catch(t){return console.error("❌ Error sending notification:",t),a.NextResponse.json({success:!1,error:"Failed to send notification"},{status:500})}}async function u(){return["mock_token_1","mock_token_2","mock_token_3"]}async function l(t,e){try{let e=0,n=0;for(let o of t)try{console.log(`✅ Notification sent to token: ${o.substring(0,16)}...`),e++}catch(t){console.error(`❌ Failed to send to token: ${o.substring(0,16)}...`,t),n++}return{successful:e,failed:n}}catch(e){return console.error("❌ Error in sendToTokens:",e),{successful:0,failed:t.length}}}async function d(t,e){try{console.log(`✅ Notification sent to topic: ${t}`)}catch(e){throw console.error(`❌ Failed to send to topic: ${t}`,e),e}}async function p(t){try{console.log("\uD83D\uDCDD Storing notification history:",{id:t.id,title:t.title,recipients:t.recipients,sentAt:t.sentAt})}catch(t){console.error("❌ Error storing notification history:",t)}}let f=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/notifications/send/route",pathname:"/api/notifications/send",filename:"route",bundlePath:"app/api/notifications/send/route"},resolvedPagePath:"/home/ubuntu/stable/src/app/api/notifications/send/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:y}=f,h="/api/notifications/send/route";function x(){return(0,r.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}}};var e=require("../../../../webpack-runtime.js");e.C(t);var n=t=>e(e.s=t),o=e.X(0,[2782,606],()=>n(80660));module.exports=o})();