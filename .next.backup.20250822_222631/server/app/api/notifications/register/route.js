"use strict";(()=>{var e={};e.id=1393,e.ids=[1393],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},83591:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>D,patchFetch:()=>x,requestAsyncStorage:()=>g,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>v});var r={};t.r(r),t.d(r,{DELETE:()=>d,POST:()=>u,PUT:()=>a});var o=t(30633),n=t(86488),i=t(13342),c=t(90223);async function u(e){try{let{token:s,userAgent:t,timestamp:r,type:o="web"}=await e.json();if(!s)return c.NextResponse.json({success:!1,error:"FCM token is required"},{status:400});let n={id:`device_${s.substring(0,16)}_${Date.now()}`,token:s,userAgent:t,type:o,registeredAt:r||new Date().toISOString(),isActive:!0,lastSeen:new Date().toISOString(),topics:["general"],preferences:{uploadSuccess:!0,uploadFailed:!0,cameraDisconnected:!0,storageWarning:!0,eventMilestone:!0,quietHours:{enabled:!1,start:"22:00",end:"08:00"}}};return console.log("\uD83D\uDCF1 Device registered:",n),await p(s),c.NextResponse.json({success:!0,data:{deviceId:n.id,topics:n.topics,message:"Device registered successfully"}})}catch(e){return console.error("❌ Error registering device:",e),c.NextResponse.json({success:!1,error:"Failed to register device"},{status:500})}}async function a(e){try{let{token:s,preferences:t,topics:r}=await e.json();if(!s)return c.NextResponse.json({success:!1,error:"FCM token is required"},{status:400});return console.log("\uD83D\uDD04 Device updated:",{token:s,preferences:t,topics:r}),c.NextResponse.json({success:!0,data:{message:"Device updated successfully"}})}catch(e){return console.error("❌ Error updating device:",e),c.NextResponse.json({success:!1,error:"Failed to update device"},{status:500})}}async function d(e){try{let{searchParams:s}=new URL(e.url),t=s.get("token");if(!t)return c.NextResponse.json({success:!1,error:"FCM token is required"},{status:400});return console.log("\uD83D\uDDD1️ Device unregistered:",t),c.NextResponse.json({success:!0,data:{message:"Device unregistered successfully"}})}catch(e){return console.error("❌ Error unregistering device:",e),c.NextResponse.json({success:!1,error:"Failed to unregister device"},{status:500})}}async function p(e){try{for(let s of["general","uploads","system"])console.log(`📢 Subscribing ${e.substring(0,16)}... to topic: ${s}`)}catch(e){console.error("❌ Error subscribing to default topics:",e)}}let l=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/notifications/register/route",pathname:"/api/notifications/register",filename:"route",bundlePath:"app/api/notifications/register/route"},resolvedPagePath:"/home/ubuntu/stable/src/app/api/notifications/register/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:f}=l,D="/api/notifications/register/route";function x(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:v})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[2782,606],()=>t(83591));module.exports=r})();