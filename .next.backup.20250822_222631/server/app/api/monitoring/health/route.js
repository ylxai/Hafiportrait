"use strict";(()=>{var e={};e.id=6755,e.ids=[6755],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},38119:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>T,requestAsyncStorage:()=>E,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>v});var n={};r.r(n),r.d(n,{GET:()=>g,OPTIONS:()=>p});var s=r(30633),a=r(86488),o=r(13342),i=r(33716),l=r(35872);async function p(e){let t=e.headers.get("origin")||e.headers.get("referer")||void 0;return(0,l.A6)(t)}async function u(){let e=Date.now();try{let t=process.env.SUPABASE_SERVICE_ROLE_KEY,r=(0,i.eI)("https://azspktldiblhrwebzmwq.supabase.co",t,{auth:{autoRefreshToken:!1,persistSession:!1}}),{data:n,error:s}=await r.from("admin_users").select("id").limit(1),a=Date.now()-e;if(s)return{name:"database",status:"unhealthy",responseTime:a,error:s.message};let{error:o}=await r.from("events").select("id").limit(1);return{name:"database",status:o?"degraded":"healthy",responseTime:a,details:{connectionTest:"passed",readTest:"passed",writeTest:o?"failed":"passed",recordCount:n?.length||0}}}catch(t){return{name:"database",status:"unhealthy",responseTime:Date.now()-e,error:t instanceof Error?t.message:"Unknown database error"}}}async function h(){let e=Date.now();try{let t={r2AccountId:process.env.R2_ACCOUNT_ID,r2AccessKey:process.env.R2_ACCESS_KEY_ID,r2SecretKey:process.env.R2_SECRET_ACCESS_KEY,r2BucketName:process.env.R2_BUCKET_NAME},r=Object.entries(t).filter(([e,t])=>!t).map(([e])=>e);if(r.length>0)return{name:"storage",status:"degraded",responseTime:Date.now()-e,details:{configStatus:"incomplete",missingConfig:r}};return{name:"storage",status:"healthy",responseTime:Date.now()-e,details:{configStatus:"complete",provider:"cloudflare-r2"}}}catch(t){return{name:"storage",status:"unhealthy",responseTime:Date.now()-e,error:t instanceof Error?t.message:"Unknown storage error"}}}async function c(){let e=Date.now();try{let t=[];return process.env.NEXT_PUBLIC_SOCKET_URL&&t.push("websocket"),process.env.GOOGLE_DRIVE_CLIENT_ID&&t.push("google-drive"),{name:"external-services",status:"healthy",responseTime:Date.now()-e,details:{configuredServices:t,count:t.length}}}catch(t){return{name:"external-services",status:"unhealthy",responseTime:Date.now()-e,error:t instanceof Error?t.message:"Unknown external services error"}}}async function m(){let e=Date.now();try{let t=["NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","JWT_SECRET","SESSION_SECRET"],r=t.filter(e=>{let t=process.env[e];return!t||"hafiportrait-secret-key-change-in-production"===t}),n=["R2_ACCOUNT_ID","GOOGLE_DRIVE_CLIENT_ID","NEXT_PUBLIC_SOCKET_URL","SLACK_WEBHOOK"].filter(e=>!!process.env[e]);if(r.length>0)return{name:"environment",status:"unhealthy",responseTime:Date.now()-e,error:`Missing required environment variables: ${r.join(", ")}`,details:{missingRequired:r,configuredOptional:n}};return{name:"environment",status:"healthy",responseTime:Date.now()-e,details:{requiredVarsCount:t.length,optionalVarsCount:n.length,configuredOptional:n}}}catch(t){return{name:"environment",status:"unhealthy",responseTime:Date.now()-e,error:t instanceof Error?t.message:"Unknown environment error"}}}async function d(){try{let e=process.memoryUsage(),t=1e3*process.uptime();return{memory:{used:e.heapUsed,total:e.heapTotal,percentage:Math.round(e.heapUsed/e.heapTotal*100)},uptime:t,nodeVersion:process.version,platform:process.platform}}catch(e){return null}}async function g(e){let t=e.headers.get("origin")||e.headers.get("referer")||void 0,r=Date.now();try{let e;let[r,n,s,a,o]=await Promise.all([u(),h(),c(),m(),d()]),i=[r,n,s,a];Date.now();let p=i.filter(e=>"healthy"===e.status).length,g=i.filter(e=>"degraded"===e.status).length,f=i.filter(e=>"unhealthy"===e.status).length;e=f>0?"unhealthy":g>0?"degraded":"healthy";let E=i.reduce((e,t)=>e+t.responseTime,0)/i.length,v=f/i.length,w={status:e,timestamp:new Date().toISOString(),uptime:o?.uptime||0,version:"1.0.0",environment:"production",checks:i,metrics:{totalChecks:i.length,healthyChecks:p,avgResponseTime:Math.round(E),errorRate:Math.round(100*v)/100},system:o};return(0,l.VM)(w,"healthy"===e?200:"degraded"===e?200:503,t)}catch(n){console.error("Health check error:",n);let e={status:"unhealthy",timestamp:new Date().toISOString(),uptime:0,version:"1.0.0",environment:"production",checks:[{name:"health-check",status:"unhealthy",responseTime:Date.now()-r,error:"Health check system failure"}],metrics:{totalChecks:1,healthyChecks:0,avgResponseTime:Date.now()-r,errorRate:1}};return(0,l.VM)(e,503,t)}}let f=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/monitoring/health/route",pathname:"/api/monitoring/health",filename:"route",bundlePath:"app/api/monitoring/health/route"},resolvedPagePath:"/home/ubuntu/stable/src/app/api/monitoring/health/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:E,staticGenerationAsyncStorage:v,serverHooks:w}=f,y="/api/monitoring/health/route";function T(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:v})}},35872:(e,t,r)=>{r.d(t,{A6:()=>p,No:()=>o,VM:()=>i,eN:()=>a,qb:()=>l});var n=r(90223);function s(){let e=["https://hafiportrait.photography","https://www.hafiportrait.photography","https://hafiportrait.vercel.app","https://hafiportrait-git-main.vercel.app","https://hafiportrait-git-develop.vercel.app","https://*.vercel.app","https://*.vercel.app/*","https://hafiportrait.com","https://www.hafiportrait.com"];if(e.push("http://147.251.255.227:3002"),process.env.ALLOWED_ORIGINS){let t=process.env.ALLOWED_ORIGINS.split(",").map(e=>e.trim());e.push(...t)}return e}function a(e){let t={"Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS, PATCH","Access-Control-Allow-Headers":"Content-Type, Authorization, X-Requested-With, X-API-Key, X-User-ID, X-User-Username, X-User-Role","Access-Control-Allow-Credentials":"true","Access-Control-Max-Age":"86400"};if(!e||function(e){let t=s();return!!("https://hafiportrait.photography"===e||"https://www.hafiportrait.photography"===e||!e||e.includes("localhost")||e.includes("127.0.0.1"))||!!t.includes(e)||t.some(t=>{if(t.includes("*")){let r=t.replace(/\*/g,".*");return RegExp(`^${r}$`).test(e)}return!1})}(e))t["Access-Control-Allow-Origin"]=e||"*";else{let e=s();t["Access-Control-Allow-Origin"]=e[0]||"*"}return t}function o(e,t){return Object.entries(a(t)).forEach(([t,r])=>{e.headers.set(t,r)}),e}function i(e,t=200,r){return o(n.NextResponse.json(e,{status:t}),r)}function l(e,t=500,r){return o(n.NextResponse.json({error:e,timestamp:new Date().toISOString(),path:"/api/auth/login"},{status:t}),r)}function p(e){return o(new n.NextResponse(null,{status:200}),e)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[2782,606,3716],()=>r(38119));module.exports=n})();